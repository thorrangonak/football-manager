<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ Football Manager â€” Proje Takip</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e17;
    --bg-card: #111827;
    --bg-card-hover: #1a2332;
    --bg-surface: #0f1520;
    --border: #1e293b;
    --border-active: #334155;
    --text: #e2e8f0;
    --text-dim: #64748b;
    --text-muted: #475569;
    --green: #10b981;
    --green-dim: #065f46;
    --green-glow: rgba(16, 185, 129, 0.15);
    --blue: #3b82f6;
    --blue-dim: #1e3a5f;
    --blue-glow: rgba(59, 130, 246, 0.12);
    --orange: #f59e0b;
    --orange-dim: #78350f;
    --red: #ef4444;
    --purple: #8b5cf6;
    --purple-dim: #4c1d95;
    --cyan: #06b6d4;
    --pink: #ec4899;
    --yellow: #eab308;
    --radius: 12px;
    --radius-sm: 8px;
    --radius-xs: 6px;
    --shadow: 0 4px 24px rgba(0,0,0,0.3);
    --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Outfit', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border-active); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(59,130,246,0.08), transparent),
      radial-gradient(ellipse 60% 40% at 80% 100%, rgba(16,185,129,0.05), transparent);
    pointer-events: none;
    z-index: 0;
  }

  .app { position: relative; z-index: 1; }

  /* â”€â”€ Header â”€â”€ */
  .header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(10, 14, 23, 0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
  }
  .header-inner {
    max-width: 1400px; margin: 0 auto;
    display: flex; align-items: center; justify-content: space-between;
    height: 72px;
  }
  .logo { display: flex; align-items: center; gap: 14px; }
  .logo-icon {
    width: 42px; height: 42px;
    background: linear-gradient(135deg, var(--green), var(--blue));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; font-weight: 800;
  }
  .logo-text { font-weight: 700; font-size: 1.2rem; }
  .logo-text span { color: var(--green); }

  .header-stats { display: flex; gap: 24px; align-items: center; }
  .h-stat { text-align: center; }
  .h-stat-val { font-size: 1.3rem; font-weight: 700; color: var(--green); }
  .h-stat-lbl { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

  /* â”€â”€ Content â”€â”€ */
  .content { max-width: 1400px; margin: 0 auto; padding: 2rem; }

  /* â”€â”€ Overview Cards â”€â”€ */
  .overview { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 12px; margin-bottom: 2rem; }
  .overview-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 16px;
    cursor: pointer; transition: var(--transition); position: relative; overflow: hidden;
  }
  .overview-card:hover { background: var(--bg-card-hover); border-color: var(--border-active); transform: translateY(-2px); }
  .overview-card.active { border-color: var(--card-accent); background: rgba(var(--card-accent-rgb), 0.08); }
  .oc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .oc-phase { font-size: 0.72rem; font-weight: 600; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }
  .oc-icon { font-size: 1.4rem; }
  .oc-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 12px; line-height: 1.3; min-height: 36px; }
  .oc-progress-bar { height: 4px; background: var(--border); border-radius: 2px; margin-bottom: 8px; overflow: hidden; }
  .oc-progress-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
  .oc-stats { display: flex; justify-content: space-between; font-size: 0.78rem; color: var(--text-dim); }

  /* â”€â”€ Toolbar â”€â”€ */
  .toolbar { display: flex; gap: 12px; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: center; }
  .search-box {
    flex: 1; min-width: 200px; padding: 10px 16px;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius-sm); color: var(--text);
    font-family: 'Outfit', sans-serif; font-size: 0.9rem;
    outline: none; transition: var(--transition);
  }
  .search-box:focus { border-color: var(--blue); }
  .filter-btns { display: flex; gap: 6px; }
  .filter-btn {
    padding: 8px 16px; border: 1px solid var(--border);
    background: var(--bg-card); color: var(--text-dim);
    border-radius: var(--radius-xs); cursor: pointer;
    font-family: 'Outfit', sans-serif; font-size: 0.82rem;
    transition: var(--transition);
  }
  .filter-btn:hover { border-color: var(--border-active); color: var(--text); }
  .filter-btn.active { background: var(--blue); border-color: var(--blue); color: #fff; }

  /* â”€â”€ IO Buttons â”€â”€ */
  .io-btns { display: flex; gap: 6px; margin-left: auto; }
  .io-btn {
    padding: 8px 14px; border: 1px solid var(--border);
    background: var(--bg-card); color: var(--text-dim);
    border-radius: var(--radius-xs); cursor: pointer;
    font-family: 'Outfit', sans-serif; font-size: 0.78rem;
    transition: var(--transition);
  }
  .io-btn:hover { border-color: var(--green); color: var(--green); }

  /* â”€â”€ Phase Sections â”€â”€ */
  .phase-section { margin-bottom: 2rem; }
  .phase-header { display: flex; align-items: center; gap: 12px; margin-bottom: 1rem; flex-wrap: wrap; }
  .phase-badge {
    padding: 4px 12px; border-radius: 20px;
    font-size: 0.78rem; font-weight: 600;
  }
  .phase-title { font-size: 1.15rem; font-weight: 700; }
  .phase-desc { font-size: 0.82rem; color: var(--text-dim); margin-left: auto; }

  /* â”€â”€ Categories â”€â”€ */
  .category {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); margin-bottom: 8px; overflow: hidden;
  }
  .category-header {
    display: flex; align-items: center; padding: 14px 18px;
    cursor: pointer; transition: var(--transition);
    user-select: none; gap: 10px;
  }
  .category-header:hover { background: var(--bg-card-hover); }
  .category-header:hover .category-title { color: var(--text); }
  .category-chevron {
    font-size: 0.65rem; color: var(--text-muted);
    transition: transform 0.25s ease; flex-shrink: 0;
    width: 16px; text-align: center;
  }
  .category-chevron.open { transform: rotate(90deg); }
  .category-title {
    font-size: 0.92rem; font-weight: 600;
    color: var(--text-dim); transition: var(--transition); flex: 1;
  }
  .category-right {
    display: flex; align-items: center; gap: 8px; margin-left: auto; flex-shrink: 0;
  }
  .category-count {
    font-size: 0.78rem; font-weight: 500;
    color: var(--text-muted); font-family: 'JetBrains Mono', monospace;
  }

  /* â”€â”€ Prompt Button â”€â”€ */
  .prompt-btn {
    padding: 4px 10px; border: 1px solid var(--purple)44;
    background: var(--purple)15; color: var(--purple);
    border-radius: var(--radius-xs); cursor: pointer;
    font-size: 0.72rem; font-weight: 600;
    font-family: 'Outfit', sans-serif;
    transition: var(--transition);
    display: flex; align-items: center; gap: 4px;
    white-space: nowrap;
  }
  .prompt-btn:hover {
    background: var(--purple)30; border-color: var(--purple);
    transform: scale(1.05);
  }

  /* â”€â”€ Tasks â”€â”€ */
  .category-tasks {
    overflow: hidden;
    transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .category-tasks.collapsed { max-height: 0 !important; }

  .task {
    display: flex; align-items: flex-start; gap: 12px;
    padding: 12px 18px 12px 48px;
    border-top: 1px solid var(--border);
    cursor: pointer; transition: var(--transition);
  }
  .task:hover { background: rgba(59,130,246,0.04); }
  .task.done { opacity: 0.5; }
  .task.done .task-text { text-decoration: line-through; }

  .checkbox {
    width: 20px; height: 20px; flex-shrink: 0;
    border: 2px solid var(--border-active);
    border-radius: 6px; display: flex;
    align-items: center; justify-content: center;
    transition: var(--transition); margin-top: 1px;
  }
  .checkbox svg {
    width: 12px; height: 12px; stroke: transparent;
    stroke-width: 3; fill: none; stroke-linecap: round; stroke-linejoin: round;
    transition: var(--transition);
  }
  .task.done .checkbox {
    background: var(--green); border-color: var(--green);
  }
  .task.done .checkbox svg { stroke: #fff; }

  .task-content { flex: 1; }
  .task-text { font-size: 0.88rem; line-height: 1.5; }
  .task-meta { display: flex; gap: 6px; margin-top: 4px; flex-wrap: wrap; }
  .task-tag {
    font-size: 0.65rem; padding: 2px 8px;
    border-radius: 4px; font-weight: 500;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .tag-critical { background: var(--red)20; color: var(--red); }
  .tag-important { background: var(--orange)20; color: var(--orange); }
  .tag-normal { background: var(--blue)15; color: var(--blue); }
  .tag-engine { background: var(--purple)15; color: var(--purple); }
  .tag-bot { background: var(--cyan)15; color: var(--cyan); }
  .tag-db { background: var(--green)15; color: var(--green); }
  .tag-api { background: var(--pink)15; color: var(--pink); }
  .tag-web { background: var(--yellow)15; color: var(--yellow); }

  /* â”€â”€ Prompt Modal â”€â”€ */
  .prompt-overlay {
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
    align-items: center; justify-content: center;
    padding: 20px;
    animation: fadeIn 0.2s ease;
  }
  .prompt-overlay.show { display: flex; }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .prompt-modal {
    background: #0d1117; border: 1px solid #30363d;
    border-radius: 16px; width: 100%; max-width: 900px;
    max-height: 85vh; display: flex; flex-direction: column;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    animation: slideUp 0.3s ease;
  }
  .prompt-modal-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 24px; border-bottom: 1px solid #30363d;
    flex-shrink: 0;
  }
  .prompt-modal-title {
    font-size: 1rem; font-weight: 700; color: var(--purple);
    display: flex; align-items: center; gap: 8px;
  }
  .prompt-modal-title::before { content: 'ğŸ“‹'; }
  .prompt-modal-actions { display: flex; gap: 8px; }

  .prompt-copy-btn {
    padding: 8px 16px; border: 1px solid var(--green)55;
    background: var(--green)15; color: var(--green);
    border-radius: var(--radius-xs); cursor: pointer;
    font-family: 'Outfit', sans-serif; font-size: 0.82rem;
    font-weight: 600; transition: var(--transition);
  }
  .prompt-copy-btn:hover { background: var(--green)30; }
  .prompt-copy-btn.copied { background: var(--green); color: #fff; }

  .prompt-close-btn {
    padding: 8px 12px; border: 1px solid #30363d;
    background: transparent; color: var(--text-dim);
    border-radius: var(--radius-xs); cursor: pointer;
    font-size: 1.1rem; transition: var(--transition);
    line-height: 1;
  }
  .prompt-close-btn:hover { background: #21262d; color: var(--text); }

  .prompt-modal-body {
    flex: 1; overflow-y: auto; padding: 0;
  }
  .prompt-modal-body::-webkit-scrollbar { width: 6px; }
  .prompt-modal-body::-webkit-scrollbar-track { background: #0d1117; }
  .prompt-modal-body::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

  .prompt-code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem; line-height: 1.7;
    color: #c9d1d9; padding: 24px;
    white-space: pre-wrap; word-wrap: break-word;
    margin: 0;
  }

  .prompt-modal-footer {
    padding: 12px 24px; border-top: 1px solid #30363d;
    display: flex; align-items: center; justify-content: space-between;
    flex-shrink: 0;
  }
  .prompt-footer-hint {
    font-size: 0.72rem; color: var(--text-muted);
  }

  /* â”€â”€ Notes â”€â”€ */
  .notes-section { margin-top: 2rem; }
  .notes-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--text-dim); }
  .notes-area {
    width: 100%; min-height: 100px; padding: 14px;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text);
    font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
    outline: none; resize: vertical; transition: var(--transition);
  }
  .notes-area:focus { border-color: var(--blue); }

  /* â”€â”€ Responsive â”€â”€ */
  @media (max-width: 768px) {
    .header-inner { height: 60px; }
    .content { padding: 1rem; }
    .overview { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
    .prompt-modal { max-width: 100%; border-radius: 12px; max-height: 90vh; }
    .prompt-code { font-size: 0.72rem; padding: 16px; }
  }
</style>
</head>
<body>
<div class="app">

  <!-- â”€â”€ Header â”€â”€ -->
  <div class="header">
    <div class="header-inner">
      <div class="logo">
        <div class="logo-icon">âš½</div>
        <div class="logo-text">Football <span>Manager</span> Tracker</div>
      </div>
      <div class="header-stats">
        <div class="h-stat">
          <div class="h-stat-val"><span id="stat-done">0</span> / <span id="stat-total">0</span></div>
          <div class="h-stat-lbl">GÃ¶rev</div>
        </div>
        <div class="h-stat">
          <div class="h-stat-val" id="stat-pct">0%</div>
          <div class="h-stat-lbl">Tamamlanan</div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <!-- â”€â”€ Overview â”€â”€ -->
    <div class="overview" id="overview"></div>

    <!-- â”€â”€ Toolbar â”€â”€ -->
    <div class="toolbar">
      <input class="search-box" type="text" placeholder="ğŸ” GÃ¶rev ara..." oninput="searchQuery=this.value; render()">
      <div class="filter-btns">
        <button class="filter-btn active" onclick="setFilter('all', this)">TÃ¼mÃ¼</button>
        <button class="filter-btn" onclick="setFilter('todo', this)">YapÄ±lacak</button>
        <button class="filter-btn" onclick="setFilter('done', this)">Tamamlanan</button>
      </div>
      <div class="io-btns">
        <button class="io-btn" onclick="exportJSON()">ğŸ“¤ DÄ±ÅŸa Aktar</button>
        <button class="io-btn" onclick="importJSON()">ğŸ“¥ Ä°Ã§e Aktar</button>
        <button class="io-btn" onclick="resetAll()">ğŸ”„ SÄ±fÄ±rla</button>
      </div>
    </div>

    <!-- â”€â”€ Phases â”€â”€ -->
    <div id="phases-container"></div>

    <!-- â”€â”€ Notes â”€â”€ -->
    <div class="notes-section">
      <div class="notes-title">ğŸ“ Notlar</div>
      <textarea class="notes-area" placeholder="Proje notlarÄ±nÄ± buraya yazabilirsin..." oninput="state.notes=this.value; saveState()" id="notes-area"></textarea>
    </div>
  </div>
</div>

<!-- â”€â”€ Prompt Modal â”€â”€ -->
<div id="prompt-modal" class="prompt-overlay" onclick="if(event.target===this)closePrompt()">
  <div class="prompt-modal">
    <div class="prompt-modal-header">
      <div class="prompt-modal-title" id="prompt-modal-title"></div>
      <div class="prompt-modal-actions">
        <button class="prompt-copy-btn" id="prompt-copy-btn" onclick="copyPrompt()">ğŸ“‹ Kopyala</button>
        <button class="prompt-close-btn" onclick="closePrompt()">âœ•</button>
      </div>
    </div>
    <div class="prompt-modal-body">
      <pre class="prompt-code" id="prompt-modal-content"></pre>
    </div>
    <div class="prompt-modal-footer">
      <span class="prompt-footer-hint">ğŸ’¡ "Kopyala" ile prompt'u panoya kopyalayÄ±p Claude'a yapÄ±ÅŸtÄ±rabilirsin</span>
    </div>
  </div>
</div>

<!-- â•â•â• Hidden Prompt Data â•â•â• -->
<textarea id="prompt-0-1" data-title="PROMPT 0.1 â€” GeliÅŸtirme OrtamÄ± Kurulumu" style="display:none">Football Manager oyun projesi iÃ§in geliÅŸtirme ortamÄ±nÄ± kur.

GitHub repo: https://github.com/thorrangonak/football-manager
Repo zaten oluÅŸturuldu ve ÅŸu yapÄ± mevcut:
- src/shared, src/engine, src/services, src/bot, src/api, src/jobs, src/socket
- prisma/, web/
- package.json, tsconfig.json, docker-compose.yml, .env.example

Åimdi yapÄ±lacaklar:

1. **package.json'Ä± gÃ¼ncelle** â€” TÃ¼m baÄŸÄ±mlÄ±lÄ±klarÄ± ekle:
   - Runtime: dotenv, zod
   - Bot: grammy
   - DB: @prisma/client, ioredis
   - API: express, cors, socket.io
   - Queue: bullmq
   - Cron: node-cron
   - Logger: winston
   - Utils: uuid
   - DevDeps: typescript, tsx, prisma, @types/*, eslint, prettier

2. **ESLint + Prettier konfigÃ¼rasyonu oluÅŸtur:**
   - .eslintrc.json (TypeScript kurallarÄ±, import sÄ±ralamasÄ±)
   - .prettierrc (singleQuote, semi, tabWidth: 2, printWidth: 100)

3. **tsconfig.json'Ä± gÃ¼ncelle:**
   - Path alias'larÄ±: @shared/*, @engine/*, @bot/*, @api/*, @services/*, @jobs/*
   - Strict mode, ES2022 target

4. **src/shared/config.ts** oluÅŸtur:
   - .env'den tÃ¼m deÄŸiÅŸkenleri oku (zod ile validasyon)
   - DATABASE_URL, REDIS_URL, BOT_TOKEN, API_PORT, JWT_SECRET vb.
   - Eksik deÄŸiÅŸken varsa hata fÄ±rlat

5. **src/shared/logger.ts** oluÅŸtur:
   - Winston logger: console + file transport
   - Log seviyeleri: error, warn, info, debug
   - Timestamp formatÄ±, JSON formatÄ±nda dosyaya yaz

6. **src/shared/types.ts** oluÅŸtur:
   - Temel TypeScript tipleri ve enum'lar:
     - Position enum: GK, CB, LB, RB, CDM, CM, CAM, LW, RW, ST, WB
     - Formation enum: F442, F433, F352, F532, F451, F343
     - Tactic enum: ATTACK, BALANCED, DEFENSIVE, ALL_OUT_ATTACK
     - MatchEventType enum: GOAL, SHOT, FOUL, YELLOW_CARD, RED_CARD, INJURY, CORNER, PENALTY, SUBSTITUTION
     - MatchStatus enum: SCHEDULED, LIVE, FINISHED, CANCELLED
     - LeagueType enum: A_LEAGUE, B_LEAGUE

TÃ¼m dosyalarÄ± oluÅŸtur ve Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula.</textarea>
<textarea id="prompt-0-2" data-title="PROMPT 0.2 â€” AltyapÄ± Servisleri (DB + Redis + Queue)" style="display:none">Football Manager projesi iÃ§in altyapÄ± servislerini kur.

Mevcut dosyalar: src/shared/config.ts, src/shared/logger.ts, src/shared/types.ts
Docker servisleri: docker-compose.yml (PostgreSQL 16 + Redis 7) hazÄ±r.

Åimdi yapÄ±lacaklar:

1. **Prisma ORM kurulumu:**
   - prisma/schema.prisma dosyasÄ±nÄ± oluÅŸtur
   - Åimdilik sadece datasource ve generator tanÄ±mla
   - Modelleri henÃ¼z ekleme (Faz 1'de eklenecek)
   - src/shared/database.ts: PrismaClient singleton instance
   - BaÄŸlantÄ± testi fonksiyonu

2. **Redis baÄŸlantÄ±sÄ±:**
   - src/shared/redis.ts: ioredis ile Redis baÄŸlantÄ±sÄ±
   - Singleton pattern
   - BaÄŸlantÄ±/disconnection event handler'larÄ±
   - Cache helper fonksiyonlarÄ±: get, set (TTL destekli), del, exists

3. **BullMQ kurulumu:**
   - src/jobs/queue.ts: Match queue tanÄ±mÄ±
   - src/jobs/worker.ts: Temel worker yapÄ±sÄ± (boÅŸ processor, ileride maÃ§ simÃ¼lasyonu eklenecek)
   - Queue baÄŸlantÄ± testi

4. **src/index.ts â€” Ana giriÅŸ noktasÄ±:**
   - TÃ¼m servislerin baÅŸlatÄ±lmasÄ± (DB, Redis, BullMQ, Bot, API)
   - Graceful shutdown handler (SIGINT, SIGTERM)
   - Startup log mesajlarÄ±

5. **BaÄŸlantÄ± testleri:**
   - Docker compose up yapÄ±lÄ±nca tÃ¼m servislerin baÄŸlanabildiÄŸini doÄŸrulayan test script
   - npm run dev ile baÅŸlatÄ±ldÄ±ÄŸÄ±nda "âœ… PostgreSQL connected", "âœ… Redis connected", "âœ… BullMQ ready" loglarÄ±

Her dosyada hata yakalama ve retry mekanizmasÄ± olsun.</textarea>
<textarea id="prompt-0-3" data-title="PROMPT 0.3 â€” Telegram Bot Temel Kurulum" style="display:none">Football Manager projesi iÃ§in Telegram bot'unun temel yapÄ±sÄ±nÄ± kur.

Mevcut: src/shared/config.ts (BOT_TOKEN), src/shared/logger.ts
KullanÄ±lacak framework: grammy

Åimdi yapÄ±lacaklar:

1. **src/bot/index.ts â€” Bot ana dosyasÄ±:**
   - grammy Bot instance oluÅŸtur (config.BOT_TOKEN ile)
   - Session middleware (in-memory veya Redis-based)
   - Error handler middleware (hatalarÄ± logla, kullanÄ±cÄ±ya "Bir hata oluÅŸtu" mesajÄ±)
   - Logger middleware (her gelen mesajÄ± logla: user_id, command, timestamp)

2. **src/bot/commands/start.ts:**
   - /start komutu handler
   - Åimdilik basit bir hoÅŸ geldin mesajÄ± gÃ¶nder:
     "âš½ Football Manager'a HoÅŸ Geldin!
      Kendi futbol takÄ±mÄ±nÄ± kur, antrenman yap, transfer yap ve ÅŸampiyon ol!
      KayÄ±t olmak iÃ§in takÄ±m ismini yaz:"
   - KullanÄ±cÄ± metin girdiÄŸinde "TakÄ±mÄ±n [Ä°sim] oluÅŸturuldu!" yanÄ±tÄ± (DB kaydÄ± Faz 1'de)

3. **src/bot/keyboards/mainMenu.ts:**
   - Ana menÃ¼ inline keyboard:
     [âš½ Kadro] [ğŸ“Š Lig Tablosu]
     [ğŸ‹ï¸ Antrenman] [ğŸ’° Transfer]
     [ğŸ‘¤ Profil] [âš™ï¸ Ayarlar]
   - Her buton callback_data tanÄ±mÄ±

4. **src/bot/middleware/auth.ts:**
   - KullanÄ±cÄ±nÄ±n kayÄ±tlÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol eden middleware
   - KayÄ±tlÄ± deÄŸilse /start'a yÃ¶nlendir

5. **Bot'u src/index.ts'e entegre et:**
   - Bot.start() ile polling baÅŸlat
   - Graceful stop ekle

Bot'u baÅŸlat, /start komutunu test et, inline keyboard'un gÃ¶rÃ¼nmesini saÄŸla.</textarea>
<textarea id="prompt-1-1" data-title="PROMPT 1.1 â€” VeritabanÄ± ÅemasÄ± (Prisma)" style="display:none">Football Manager projesi iÃ§in Prisma veritabanÄ± ÅŸemasÄ±nÄ± oluÅŸtur.

Dosya: prisma/schema.prisma

AÅŸaÄŸÄ±daki modelleri tanÄ±mla:

1. **User:**
   - id: Int @id @default(autoincrement())
   - tgId: BigInt @unique (Telegram user ID)
   - username: String? (TG username)
   - level: Int @default(1)
   - xp: Int @default(0)
   - coins: Int @default(50000)
   - isNewPlayer: Boolean @default(true) (ilk 2 hafta koruma)
   - newPlayerUntil: DateTime? (koruma sÃ¼resi)
   - lastDailyReward: DateTime? (gÃ¼nlÃ¼k Ã¶dÃ¼l)
   - notificationPrefs: Json? (bildirim tercihleri)
   - createdAt: DateTime @default(now())
   - updatedAt: DateTime @updatedAt
   - Ä°liÅŸkiler: team (1-1), transactions

2. **Team:**
   - id: Int @id @default(autoincrement())
   - userId: Int @unique
   - name: String @unique (takÄ±m adÄ±, max 30 karakter)
   - formation: String @default("F442") (Formation enum)
   - tactic: String @default("BALANCED") (Tactic enum)
   - powerRating: Float @default(0) (ortalama overall)
   - stadiumLevel: Int @default(1)
   - stadiumMaintained: Boolean @default(true)
   - createdAt: DateTime @default(now())
   - Ä°liÅŸkiler: user, players[], leagueTeams[], homeMatches[], awayMatches[], transfersFrom[], transfersTo[]

3. **Player (Futbolcu):**
   - id: Int @id @default(autoincrement())
   - teamId: Int? (null = serbest oyuncu)
   - name: String
   - age: Int (17-38)
   - position: String (Position enum)
   - altPosition: String? (alternatif pozisyon)
   - isStarter: Boolean @default(false) (ilk 11'de mi)
   - jerseyNumber: Int?

   // 7 Ana Stat (1-99)
   - speed: Float @default(50)
   - shooting: Float @default(50)
   - passing: Float @default(50)
   - dribbling: Float @default(50)
   - defense: Float @default(50)
   - physical: Float @default(50)
   - goalkeeping: Float @default(50)

   // Overall
   - overall: Float @default(50) (pozisyona gÃ¶re aÄŸÄ±rlÄ±klÄ± hesaplama)

   // Dinamik Statlar
   - morale: Float @default(70) (0-100)
   - form: Float @default(50) (son 5 maÃ§ ortalamasÄ±)
   - fitness: Float @default(100) (kondisyon, 0-100)
   - injuryDuration: Int @default(0) (kalan sakatlÄ±k sÃ¼resi, maÃ§ sayÄ±sÄ±)
   - suspendedUntil: Int @default(0) (cezalÄ± maÃ§ sayÄ±sÄ±)
   - yellowCards: Int @default(0) (sezon toplam sarÄ±)

   // Ekonomi
   - marketValue: Int @default(10000)
   - salary: Int @default(200)

   // Antrenman
   - lastTrainingAt: DateTime?
   - trainingCooldownUntil: DateTime?

   - createdAt: DateTime @default(now())
   - Ä°liÅŸkiler: team, matchEvents[], goalsScoredIn[], assistsIn[]

4. **League:**
   - id: Int @id @default(autoincrement())
   - name: String (Ã¶rn: "A Ligi", "B Ligi")
   - type: String (A_LEAGUE / B_LEAGUE)
   - seasonId: Int
   - status: String @default("ACTIVE") (ACTIVE, FINISHED, TRANSFER_WINDOW)
   - Ä°liÅŸkiler: season, leagueTeams[], matches[]

5. **LeagueTeam (Lig-TakÄ±m baÄŸlantÄ±sÄ±):**
   - id: Int @id @default(autoincrement())
   - leagueId: Int
   - teamId: Int
   - played: Int @default(0)
   - wins: Int @default(0)
   - draws: Int @default(0)
   - losses: Int @default(0)
   - goalsFor: Int @default(0)
   - goalsAgainst: Int @default(0)
   - points: Int @default(0)
   - @@unique([leagueId, teamId])

6. **Match:**
   - id: Int @id @default(autoincrement())
   - leagueId: Int?
   - seasonId: Int?
   - homeTeamId: Int
   - awayTeamId: Int
   - scheduledAt: DateTime
   - status: String @default("SCHEDULED")
   - homeScore: Int @default(0)
   - awayScore: Int @default(0)
   - matchWeek: Int?
   - isFriendly: Boolean @default(false)
   - matchData: Json? (detaylÄ± maÃ§ istatistikleri)
   - Ä°liÅŸkiler: league, homeTeam, awayTeam, events[]

7. **MatchEvent:**
   - id: Int @id @default(autoincrement())
   - matchId: Int
   - tick: Int (0-59)
   - minute: Int (1-90)
   - type: String (MatchEventType enum)
   - teamId: Int?
   - playerId: Int?
   - secondPlayerId: Int? (asist yapan, faul yapÄ±lan vb.)
   - detail: Json? (ek bilgi)
   - commentary: String? (TÃ¼rkÃ§e yorum)

8. **Transfer:**
   - id: Int @id @default(autoincrement())
   - playerId: Int
   - fromTeamId: Int?
   - toTeamId: Int?
   - price: Int
   - status: String @default("PENDING") (PENDING, ACCEPTED, REJECTED, EXPIRED)
   - expiresAt: DateTime?
   - createdAt: DateTime @default(now())

9. **Season:**
   - id: Int @id @default(autoincrement())
   - number: Int (sezon numarasÄ±)
   - startDate: DateTime
   - endDate: DateTime
   - status: String @default("ACTIVE")
   - Ä°liÅŸkiler: leagues[], matches[]

10. **Transaction (Para hareketleri):**
    - id: Int @id @default(autoincrement())
    - userId: Int
    - amount: Int (pozitif = gelir, negatif = gider)
    - type: String (MATCH_WIN, MATCH_DRAW, MATCH_LOSS, SALARY, TRAINING, TRANSFER_BUY, TRANSFER_SELL, DAILY_REWARD, LEVEL_UP, SEASON_PRIZE, STADIUM, MEDICAL)
    - description: String?
    - createdAt: DateTime @default(now())

Her modelde gerekli indexleri ekle (@index). Ä°liÅŸkilerde onDelete kurallarÄ±nÄ± belirle.
Migration oluÅŸtur ve Ã§alÄ±ÅŸtÄ±r: npx prisma migrate dev --name init
ArdÄ±ndan npx prisma generate Ã§alÄ±ÅŸtÄ±r.</textarea>
<textarea id="prompt-1-2" data-title="PROMPT 1.2 â€” Oyuncu OluÅŸturma Motoru" style="display:none">Football Manager projesi iÃ§in futbolcu oluÅŸturma motorunu yaz.

Dosya: src/engine/playerGenerator.ts

Mevcut: prisma/schema.prisma (Player modeli), src/shared/types.ts (Position enum)

Kurallar (Game Design Document'tan):

**Pozisyona GÃ¶re Stat DaÄŸÄ±lÄ±mÄ± (aÄŸÄ±rlÄ±klÄ± rastgele):**
Her pozisyonun "gÃ¼Ã§lÃ¼" statlarÄ± var, bunlar daha yÃ¼ksek Ã¼retilir.
- GK: goalkeeping Ã—2.0, physical Ã—1.3, defense Ã—1.2
- CB: defense Ã—2.0, physical Ã—1.5, speed Ã—0.8
- LB/RB: speed Ã—1.5, defense Ã—1.3, passing Ã—1.2
- CDM: defense Ã—1.5, passing Ã—1.3, physical Ã—1.3
- CM: passing Ã—1.8, dribbling Ã—1.2, shooting Ã—1.0
- CAM: passing Ã—1.5, dribbling Ã—1.5, shooting Ã—1.3
- LW/RW: speed Ã—1.8, dribbling Ã—1.5, shooting Ã—1.0
- ST: shooting Ã—2.0, speed Ã—1.3, dribbling Ã—1.2
- WB: speed Ã—1.5, defense Ã—1.2, passing Ã—1.2, physical Ã—1.2

Fonksiyonlar:

1. **generatePlayer(options):**
   - options: { position, minOvr?, maxOvr?, age? }
   - Base stat Ã¼ret: minOvr-maxOvr aralÄ±ÄŸÄ±nda hedef overall
   - Pozisyon aÄŸÄ±rlÄ±klarÄ±na gÃ¶re 7 stat'Ä± daÄŸÄ±t
   - Her stat 1-99 arasÄ±nda clamp et
   - YaÅŸ: verilmezse rastgele 17-33 (aÄŸÄ±rlÄ±klÄ±: 20-28 daha olasÄ±)
   - Ä°sim: rastgele TÃ¼rkÃ§e isim havuzundan

2. **calculateOverall(player, position):**
   Pozisyona gÃ¶re aÄŸÄ±rlÄ±klÄ± ortalama:
   - GK: REFÃ—0.45 + PHYÃ—0.20 + DEFÃ—0.15 + SPDÃ—0.10 + PASÃ—0.10
   - CB: DEFÃ—0.35 + PHYÃ—0.25 + SPDÃ—0.15 + PASÃ—0.15 + SHTÃ—0.10
   - LB/RB: SPDÃ—0.25 + DEFÃ—0.25 + PASÃ—0.20 + PHYÃ—0.15 + DRBÃ—0.15
   - CDM: DEFÃ—0.30 + PASÃ—0.25 + PHYÃ—0.25 + SPDÃ—0.10 + DRBÃ—0.10
   - CM: PASÃ—0.30 + DRBÃ—0.20 + SHTÃ—0.15 + DEFÃ—0.15 + PHYÃ—0.10 + SPDÃ—0.10
   - CAM: PASÃ—0.25 + DRBÃ—0.25 + SHTÃ—0.25 + SPDÃ—0.15 + PHYÃ—0.10
   - LW/RW: SPDÃ—0.30 + DRBÃ—0.25 + SHTÃ—0.20 + PASÃ—0.15 + PHYÃ—0.10
   - ST: SHTÃ—0.35 + SPDÃ—0.20 + DRBÃ—0.20 + PHYÃ—0.15 + PASÃ—0.10
   - WB: SPDÃ—0.20 + DEFÃ—0.20 + PASÃ—0.20 + PHYÃ—0.20 + DRBÃ—0.20

3. **calculateMarketValue(player):**
   - Base: overallÂ² Ã— 15
   - YaÅŸ Ã§arpanÄ±: 17-21 â†’ Ã—1.4, 22-27 â†’ Ã—1.0, 28-30 â†’ Ã—0.7, 31-33 â†’ Ã—0.4, 34+ â†’ Ã—0.2
   - Form bonus: (form / 50) Ã§arpanÄ±

4. **calculateSalary(marketValue):**
   - marketValue Ã— 0.02 (haftalÄ±k)

5. **generateStarterPack():**
   - 18 futbolcu Ã¼ret:
     - 2 GK (1 starter)
     - 2 CB (2 starter) + 1 yedek CB
     - 1 LB (starter) + 1 RB (starter)
     - 2 CM (starter) + 1 CDM (starter)
     - 1 CAM (yedek)
     - 1 LW (starter) + 1 RW (starter)
     - 2 ST (1 starter, 1 yedek)
     - 1 WB (yedek)
   - OVR aralÄ±ÄŸÄ±: 45-60
   - 1 yÄ±ldÄ±z oyuncu: 65-70 OVR garantisi (rastgele pozisyon)
   - Forma numaralarÄ±: 1-18 ata

6. **TÃœRKÃ‡E Ä°SÄ°M HAVUZU:**
   - En az 100 isim, 100 soyisim
   - Rastgele isim + soyisim kombinasyonu
   - AynÄ± takÄ±mda aynÄ± isimde 2 oyuncu olmasÄ±n

TÃ¼m fonksiyonlarÄ± export et ve test iÃ§in bir test script (src/engine/__tests__/playerGenerator.test.ts) yaz:
- 18 kiÅŸilik starter pack Ã¼ret, overall'larÄ±n 45-70 arasÄ±nda olduÄŸunu doÄŸrula
- Her pozisyon tipinden en az 1 oyuncu olduÄŸunu doÄŸrula</textarea>
<textarea id="prompt-1-3" data-title="PROMPT 1.3 â€” Telegram Bot: KayÄ±t, TakÄ±m, Kadro YÃ¶netimi" style="display:none">Football Manager projesi iÃ§in Telegram bot'unun kayÄ±t ve takÄ±m yÃ¶netim komutlarÄ±nÄ± yaz.

Mevcut: Prisma modelleri, playerGenerator.ts, bot temel yapÄ±sÄ± (grammy)

Komutlar:

1. **/start â€” KayÄ±t:**
   - DB'de user var mÄ± kontrol et (tgId ile)
   - Yoksa: "âš½ HoÅŸ geldin! TakÄ±mÄ±na bir isim ver:" â†’ conversation/session ile isim al
   - Ä°sim gelince:
     - User oluÅŸtur (coins: 50000)
     - Team oluÅŸtur (verilen isim)
     - generateStarterPack() ile 18 futbolcu oluÅŸtur ve team'e ata
     - TakÄ±m power_rating'ini hesapla
     - HoÅŸ geldin mesajÄ± + ana menÃ¼ keyboard gÃ¶ster
   - Zaten kayÄ±tlÄ±ysa: "Zaten bir takÄ±mÄ±n var: [TakÄ±m AdÄ±]" + ana menÃ¼

2. **/kadro â€” Kadro GÃ¶rÃ¼ntÃ¼leme:**
   - Mevcut formasyon gÃ¶ster (Ã¶rn: "ğŸ“‹ 4-4-2")
   - Ä°lk 11'i pozisyonlarÄ±na gÃ¶re sÄ±ralÄ± listele:</textarea>
<textarea id="prompt-1-4" data-title="PROMPT 1.4 â€” MaÃ§ SimÃ¼lasyon Motoru" style="display:none">Football Manager projesi iÃ§in maÃ§ simÃ¼lasyon motorunu yaz.

Dosya: src/engine/matchEngine.ts

Bu projenin KALBÄ° â€” en Ã¶nemli ve dikkatli yazÄ±lmasÄ± gereken dosya.

**GENEL YAPI:**
- 60 tick = 1 maÃ§ = 90 oyun dakikasÄ± (1 tick = 1 saniye gerÃ§ek sÃ¼re = 1.5 dk oyun)
- Her tick'te %35 olay ÅŸansÄ±
- SonuÃ§: Match nesnesi (skor, olaylar listesi, istatistikler)

**SINIFLAR VE FONKSÄ°YONLAR:**

1. **MatchEngine class:**

   constructor(homeTeam: MatchTeam, awayTeam: MatchTeam, matchId: number)

   **MatchTeam tipi:**</textarea>
<textarea id="prompt-1-5" data-title="PROMPT 1.5 â€” Lig Sistemi &amp; FikstÃ¼r" style="display:none">Football Manager projesi iÃ§in lig sistemi ve fikstÃ¼r oluÅŸturma motorunu yaz.

Dosyalar:
- src/engine/leagueManager.ts
- src/engine/fixtureGenerator.ts
- src/services/leagueService.ts

**1. FikstÃ¼r OluÅŸturma (Round-Robin):**

   function generateFixtures(teamIds: number[]): Fixture[][]

   - Round-robin algoritmasÄ±: Her takÄ±m birbirine 1 kez maÃ§
   - N takÄ±m varsa N-1 hafta, her hafta N/2 maÃ§
   - Tek sayÄ± takÄ±m varsa bye sistemi (o hafta maÃ§Ä± yok)
   - Ev/deplasman dengeli olsun (mÃ¼mkÃ¼n olduÄŸunca eÅŸit)
   - Return tipi: Fixture[][] (hafta bazlÄ± gruplanmÄ±ÅŸ)</textarea>
<textarea id="prompt-2-1" data-title="PROMPT 2.1 â€” Ekonomi Sistemi" style="display:none">Football Manager projesi iÃ§in ekonomi sistemini yaz.

Dosyalar:
- src/services/economyService.ts
- src/services/transactionService.ts

**EconomyService class:**

1. **addCoins(userId, amount, type, description):**
   - User.coins += amount
   - Transaction kaydÄ± oluÅŸtur
   - Return: yeni bakiye

2. **removeCoins(userId, amount, type, description):**
   - Bakiye kontrolÃ¼: coins &gt;= amount
   - Yetersiz bakiye â†’ hata fÄ±rlat
   - User.coins -= amount
   - Transaction kaydÄ± oluÅŸtur

3. **processMatchReward(userId, result: 'WIN' | 'DRAW' | 'LOSS'):**
   - WIN: +5000, DRAW: +2000, LOSS: +500
   - Yeni oyuncu korumasÄ± varsa (isNewPlayer &amp;&amp; kaybettiyse): ekstra +2000

4. **processWeeklySalaries():**
   - TÃ¼m aktif takÄ±mlar iÃ§in:
     - Toplam maaÅŸ = takÄ±mdaki tÃ¼m oyuncularÄ±n salary toplamÄ±
     - coins &gt;= toplamMaaÅŸ â†’ Ã¶de
     - coins &lt; toplamMaaÅŸ â†’ Ã–DEME YAPILAMADI:
       - TÃ¼m oyunculara moral -30
       - Log ve bildirim oluÅŸtur

5. **processStadiumMaintenance():**
   - Her takÄ±mdan haftalÄ±k 5000 coin
   - Ã–denirse: stadiumMaintained = true (ev avantajÄ± aktif)
   - Ã–denmezse: stadiumMaintained = false (ev avantajÄ± iptal)

6. **processDailyReward(userId):**
   - Son Ã¶dÃ¼l tarihi kontrol: aynÄ± gÃ¼n mÃ¼?
   - DeÄŸilse: +1000 coin, lastDailyReward gÃ¼ncelle
   - AynÄ± gÃ¼nse: "BugÃ¼n zaten Ã¶dÃ¼lÃ¼nÃ¼ aldÄ±n!"

7. **processSeasonPrize(userId, rank, leagueType):**
   - A Ligi: 1. â†’ 100K, 2. â†’ 60K, 3. â†’ 35K, diÄŸer â†’ 10K
   - B Ligi: 1. â†’ 50K, 2. â†’ 30K, 3. â†’ 20K, diÄŸer â†’ 5K

8. **processLevelUp(userId, newLevel):**
   - Ã–dÃ¼l: 5000 Ã— newLevel

**Bot KomutlarÄ±:**
- /bakiye: Mevcut coin gÃ¶ster + son 10 iÅŸlem
- /gunluk: GÃ¼nlÃ¼k Ã¶dÃ¼l al
- /gelir: Son 7 gÃ¼nlÃ¼k gelir/gider Ã¶zeti

**Cron Job (src/jobs/weeklyCron.ts):**
- Her Pazartesi 00:00: processWeeklySalaries() + processStadiumMaintenance()</textarea>
<textarea id="prompt-2-2" data-title="PROMPT 2.2 â€” Transfer PazarÄ±" style="display:none">Football Manager projesi iÃ§in transfer pazarÄ± sistemini yaz.

Dosyalar:
- src/services/transferService.ts
- src/bot/commands/transfer.ts
- src/bot/handlers/transferHandler.ts

**TransferService class:**

1. **listMarketPlayers(filters?):**
   - Sistem tarafÄ±ndan Ã¼retilmiÅŸ NPC futbolcular (teamId = null)
   - Her gÃ¼n 5-10 yeni NPC oyuncu Ã¼retilir (cron)
   - Filtreleme: pozisyon, min/max OVR, max fiyat
   - Fiyat = marketValue Ã— (1 + talep Ã§arpanÄ±)

2. **buyFromMarket(userId, playerId):**
   - Oyuncu kontrolÃ¼: teamId == null (satÄ±ÅŸta mÄ±?)
   - Bakiye kontrolÃ¼
   - Kadro limiti: max 25 oyuncu
   - Para kes, oyuncuyu takÄ±ma ata
   - Transfer kaydÄ± oluÅŸtur

3. **sendTransferOffer(fromUserId, toPlayerId, offerPrice):**
   - Oyuncu sahibi kontrolÃ¼
   - Teklif fiyat kontrolÃ¼: min %50 marketValue (altÄ± â†’ blok, anti-abuse)
   - Yeni oyuncu ilk hafta transfer engeli kontrolÃ¼
   - AynÄ± 2 kullanÄ±cÄ± arasÄ±nda gÃ¼nde max 1 transfer kontrolÃ¼
   - Transfer gÃ¼Ã§lÃ¼ ligden zayÄ±f lige: +%50 vergi
   - Transfer kaydÄ±: status=PENDING, expiresAt=24 saat sonra
   - KarÅŸÄ± tarafa bildirim gÃ¶nder

4. **acceptOffer(transferId, userId):**
   - Transfer sahibi mi kontrol
   - Bakiye kontrolÃ¼ (alÄ±cÄ±nÄ±n)
   - Para transfer: alÄ±cÄ± â†’ satÄ±cÄ±
   - Oyuncu team deÄŸiÅŸtir
   - Her iki taraf bildirim

5. **rejectOffer(transferId, userId):**
   - Status = REJECTED
   - Teklif sahibine bildirim

6. **sellPlayer(userId, playerId, price):**
   - Min 11 oyuncu kontrolÃ¼ (11'den az satamaz)
   - Oyuncuyu serbest bÄ±rak (teamId = null, pazara dÃ¼ÅŸÃ¼r)
   - Para ekle

7. **expireTransfers():**
   - Cron: 24 saati geÃ§miÅŸ PENDING transferleri EXPIRED yap

**Anti-Abuse KurallarÄ±:**
- Piyasa deÄŸerinin %50 altÄ±na satÄ±ÅŸ/teklif â†’ otomatik blok + uyarÄ±
- AynÄ± 2 kiÅŸi arasÄ±nda gÃ¼nde max 1 transfer
- Yeni oyuncu ilk 7 gÃ¼n transfer yapamaz
- GÃ¼Ã§lÃ¼ ligden zayÄ±f lige transfer: +%50 vergi

**Bot â€” /transfer komutu:**
- Ana menÃ¼:
  [ğŸ›’ Pazar] [ğŸ“¤ Sat] [ğŸ“¨ Tekliflerim] [ğŸ“© Gelen Teklifler]

- Pazar: Pozisyon filtreli oyuncu listesi, sayfalÄ±, "SatÄ±n Al" butonu
- Sat: Kendi oyuncularÄ±ndan seÃ§, fiyat belirle
- Tekliflerim: GÃ¶nderdiÄŸim teklifler (bekleyen/kabul/red)
- Gelen Teklifler: Bana gelen teklifler â†’ [âœ… Kabul] [âŒ Red]</textarea>
<textarea id="prompt-2-3" data-title="PROMPT 2.3 â€” Antrenman &amp; GeliÅŸim Sistemi" style="display:none">Football Manager projesi iÃ§in antrenman ve geliÅŸim sistemini yaz.

Dosyalar:
- src/services/trainingService.ts
- src/engine/developmentEngine.ts
- src/bot/commands/training.ts

**Antrenman Tipleri:**

| Tip | Maliyet | Etki | Cooldown | Yan Etki |
|-----|---------|------|----------|----------|
| Kondisyon KampÄ± | 500 | Kondisyon +30 | 12 saat | â€” |
| Teknik Antrenman | 2000 | SeÃ§ilen stat +0.5 | 24 saat | Kondisyon -5 |
| Fizik AntrenmanÄ± | 2000 | PHY +0.5, SPD +0.3 | 24 saat | Kondisyon -10 |
| YoÄŸun Kamp | 5000 | SeÃ§ilen stat +1.0 | 36 saat | Kondisyon -20 |
| Elit Kamp | 10000 | 2 seÃ§ilen stat +1.0 | 48 saat | Kondisyon -25 |

**YaÅŸ BazlÄ± GeliÅŸim Ã‡arpanÄ±:**
- 17-21: Ã—1.5
- 22-27: Ã—1.0
- 28-30: Ã—0.6
- 31-33: Ã—0.3
- 34-36: Ã—0.0 (geliÅŸim duraklar)
- 37-38: Ã—-0.3 (gerileme, stat dÃ¼ÅŸÃ¼ÅŸÃ¼)

**Catchup MekanizmasÄ± (DÃ¼ÅŸÃ¼k OVR hÄ±zlÄ± geliÅŸir):**
- OVR 40-55: Ã—2.0
- OVR 56-65: Ã—1.5
- OVR 66-75: Ã—1.0
- OVR 76-85: Ã—0.7
- OVR 86-99: Ã—0.4

**TrainingService:**

1. **trainPlayer(userId, playerId, trainingType, targetStat?):**
   - Cooldown kontrolÃ¼ (lastTrainingAt + cooldown &gt; now â†’ ret)
   - Bakiye kontrolÃ¼
   - SakatlÄ±k kontrolÃ¼ (sakatken antrenman yapÄ±lamaz)
   - GeliÅŸim hesapla:
     statGain = baseGain Ã— ageMultiplier Ã— catchupMultiplier Ã— (coachBonus || 1.0)
   - Stat gÃ¼ncelle (max 99, min 1)
   - Overall yeniden hesapla
   - Piyasa deÄŸeri yeniden hesapla
   - Kondisyon dÃ¼ÅŸÃ¼r
   - Cooldown baÅŸlat
   - Para kes
   - XP ekle: 50 Ã— trainingType seviyesi

2. **processPassiveDevelopment(playerId, matchStats):**
   - MaÃ§ sonrasÄ± otomatik (her maÃ§ oynayan oyuncuya):
   - Rastgele 1-2 stat seÃ§
   - +0.1 ile +0.3 arasÄ± geliÅŸim (yaÅŸ/catchup Ã§arpanÄ± uygulanÄ±r)
   - Ã–zel kurallar:
     - Gol atan ST/CAM â†’ SHT +0.2
     - Asist yapan â†’ PAS +0.2
     - Clean sheet GK â†’ REF +0.2
     - Clean sheet CB â†’ DEF +0.2

3. **processAging(seasonEnd):**
   - Sezon sonunda tÃ¼m oyuncularÄ±n yaÅŸÄ± +1
   - 34+ oyuncular: rastgele 2-3 stat'ta -0.5 ile -1.0 arasÄ± gerileme
   - 37+ oyuncular: daha sert gerileme (-1.0 ile -2.0)
   - Emeklilik: 38 yaÅŸÄ±nÄ± geÃ§en oyuncular emekli olabilir (%30 ÅŸans)

**AntrenÃ¶r Sistemi:**

| AntrenÃ¶r | Maliyet | SÃ¼re | Bonus | Ekstra |
|----------|---------|------|-------|--------|
| Bronz | 10.000 | 7 gÃ¼n | +%20 antrenman | â€” |
| GÃ¼mÃ¼ÅŸ | 25.000 | 7 gÃ¼n | +%40 antrenman | â€” |
| AltÄ±n | 50.000 | 7 gÃ¼n | +%60 antrenman | SakatlÄ±k riski -%20 |

4. **hireCoach(userId, tier: 'bronze'|'silver'|'gold'):**
   - Bakiye kontrol, para kes
   - Coach kaydÄ±: tier, expiresAt = now + 7 gÃ¼n
   - Antrenman hesaplamalarÄ±nda bonus uygula

**Bot â€” /antrenman komutu:**
- Oyuncu seÃ§ (inline keyboard, sayfalÄ±)
- Antrenman tipi seÃ§
- Teknik/YoÄŸun/Elit iÃ§in stat seÃ§ (SPD/SHT/PAS/DRB/DEF/PHY/REF)
- Onay: "[Oyuncu] iÃ§in [Antrenman] yapÄ±lsÄ±n mÄ±? ğŸ’° [Maliyet]"
- SonuÃ§: "âœ… [Oyuncu]: SPD 62.3 â†’ 63.1 (+0.8)"</textarea>
<textarea id="prompt-2-4" data-title="PROMPT 2.4 â€” Seviye Sistemi" style="display:none">Football Manager projesi iÃ§in seviye ve XP sistemini yaz.

Dosya: src/services/levelService.ts

**XP Kazanma KurallarÄ±:**
| Aksiyon | XP |
|---------|-----|
| MaÃ§ oyna (sonuÃ§ fark etmez) | +100 |
| MaÃ§ kazan | +200 |
| MaÃ§ berabere | +100 |
| Gol at (her gol) | +50 |
| Clean sheet | +150 |
| Antrenman yap | +50 |
| GÃ¼nlÃ¼k giriÅŸ | +25 |
| Transfer yap (al veya sat) | +75 |
| Rehberi tamamla | +500 |

**Seviye FormÃ¼lÃ¼:**
- requiredXP(level) = 1000 Ã— level Ã— (1 + level Ã— 0.1)
- Seviye 1â†’2: 1100 XP
- Seviye 5â†’6: 8000 XP
- Seviye 10â†’11: 21000 XP

**Seviye Atlama Ã–dÃ¼lleri:**
- Coin: 5000 Ã— newLevel
- Her 5 seviyede bonus: Ãœcretsiz YoÄŸun Kamp hakkÄ±

**LevelService:**
1. addXP(userId, amount, source): XP ekle, seviye kontrolÃ¼ yap
2. checkLevelUp(userId): XP yeterliyse seviye atla, Ã¶dÃ¼l ver
3. getLevelInfo(userId): Mevcut seviye, XP, sonraki seviyeye kalan

**Bot â€” /profil komutu:**</textarea>
<textarea id="prompt-3-1" data-title="PROMPT 3.1 â€” Sezon DÃ¶ngÃ¼sÃ¼ &amp; Otomatik Zamanlama" style="display:none">Football Manager projesi iÃ§in sezon dÃ¶ngÃ¼sÃ¼ ve otomatik maÃ§ zamanlama sistemini yaz.

Dosyalar:
- src/services/seasonService.ts
- src/jobs/matchScheduler.ts
- src/jobs/cronJobs.ts

**Sezon YapÄ±sÄ±:**
- 8 hafta toplam: 7 hafta lig + 1 hafta transfer dÃ¶nemi
- Haftada 2 maÃ§ gÃ¼nÃ¼: Ã‡arÅŸamba 20:00, Cuma 20:00
- Her maÃ§ gÃ¼nÃ¼ aynÄ± anda max 7-8 maÃ§ (5'er dk arayla: 20:00, 20:05, 20:10...)
- Pazar 18:00: Åampiyonlar Ligi (Faz 5'te eklenecek)

**SeasonService:**

1. **startNewSeason():**
   - Season kaydÄ± oluÅŸtur (number++, startDate, endDate)
   - TakÄ±mlarÄ± liglere daÄŸÄ±t:
     - A Ligi: Ãœst takÄ±mlar (powerRating sÄ±ralamasÄ± veya Ã¶nceki sezon)
     - B Ligi: Alt takÄ±mlar + yeni oyuncular
     - Ä°lk sezon: TÃ¼m takÄ±mlar tek lige (B Ligi gibi davran)
   - Her lig iÃ§in fikstÃ¼r oluÅŸtur
   - MaÃ§larÄ± zamanla (Ã‡ar+Cum, 20:00'den itibaren 5'er dk)
   - TÃ¼m LeagueTeam istatistiklerini sÄ±fÄ±rla
   - Duyuru gÃ¶nder: "ğŸŸï¸ Sezon [N] baÅŸladÄ±!"

2. **endSeason(seasonId):**
   - TÃ¼m maÃ§lar oynandÄ± mÄ± kontrol
   - SÄ±ralama finalize
   - Ã–dÃ¼lleri daÄŸÄ±t (SeasonPrize)
   - Relegation/Promotion:
     - A Ligi son 2 â†’ B Ligi
     - B Ligi ilk 2 â†’ A Ligi
   - Ä°statistik Ã¶dÃ¼lleri: Gol kralÄ±, asist kralÄ± vb.
   - Transfer dÃ¶nemini baÅŸlat (1 hafta)
   - YaÅŸlandÄ±rma: TÃ¼m oyuncularÄ±n yaÅŸÄ± +1
   - Gerileme: 34+ oyuncularda stat dÃ¼ÅŸÃ¼ÅŸÃ¼

3. **startTransferWindow():**
   - 7 gÃ¼n serbest transfer dÃ¶nemi
   - NPC oyuncu sayÄ±sÄ±nÄ± artÄ±r (normalin 2 katÄ±)
   - Transfer dÃ¶nemi sonu: otomatik kapat, yeni sezon baÅŸlat

**Match Scheduler (BullMQ):**

1. **scheduleMatches():**
   - Gelecek haftanÄ±n maÃ§larÄ±nÄ± BullMQ'ya delayed job olarak ekle
   - Her maÃ§ iÃ§in:
     - scheduledAt zamanÄ±nda tetiklenecek job
     - Job data: matchId, homeTeamId, awayTeamId

2. **processMatch(job):**
   - MaÃ§ verilerini DB'den Ã§ek (takÄ±mlar, oyuncular, formasyonlar)
   - SakatlarÄ± ve cezalÄ±larÄ± Ã§Ä±kar, yedekten tamamla
   - MatchEngine.simulateMatch() Ã§alÄ±ÅŸtÄ±r
   - SonuÃ§larÄ± DB'ye kaydet
   - Lig tablosu gÃ¼ncelle
   - Ã–dÃ¼lleri daÄŸÄ±t
   - Bildirimleri gÃ¶nder
   - Match Tracker eventlerini emit et (Socket.IO, Faz 4'te)

3. **Worker yapÄ±sÄ±:**
   - 3 worker paralel Ã§alÄ±ÅŸÄ±r
   - Her worker 1 maÃ§Ä± sÄ±ralÄ± iÅŸler
   - MaÃ§lar 5'er dakika arayla baÅŸlar â†’ Ã§akÄ±ÅŸma yok

**Cron Jobs (node-cron):**

| Cron | Ä°ÅŸ | Zaman |
|------|----|-------|
| matchReminder1h | MaÃ§ 1 saat kala bildirim | MaÃ§ saatine gÃ¶re dinamik |
| matchReminder10m | MaÃ§ 10 dk kala bildirim | MaÃ§ saatine gÃ¶re dinamik |
| weeklySalaries | MaaÅŸ kesimi | Pazartesi 00:00 |
| stadiumMaintenance | Stadyum bakÄ±mÄ± | Pazartesi 00:00 |
| dailyNPCRefresh | NPC transfer pazarÄ±nÄ± yenile | Her gÃ¼n 06:00 |
| expireTransfers | SÃ¼resi dolan transferleri iptal | Her saat baÅŸÄ± |
| fitnessRecovery | Kondisyon toparlanmasÄ± | Her saat: +3 fitness (max 100) |

Kondisyon toparlanmasÄ±: Her saat baÅŸÄ± tÃ¼m oyuncularÄ±n fitness'Ä± +3 artar (max 100).</textarea>
<textarea id="prompt-3-2" data-title="PROMPT 3.2 â€” Bildirim Sistemi" style="display:none">Football Manager projesi iÃ§in Telegram bildirim sistemini yaz.

Dosya: src/services/notificationService.ts

**NotificationService:**

1. **sendToUser(userId, message, keyboard?):**
   - TG Bot Ã¼zerinden DM gÃ¶nder
   - Keyboard varsa inline button ekle

2. **sendToLeague(leagueId, message):**
   - Ligteki tÃ¼m oyunculara gÃ¶nder

3. **Bildirim TÃ¼rleri:**

   a) **matchReminder(matchId, minutesBefore):**
      - 60 dk: "â° MaÃ§Ä±n 1 saat sonra! [TakÄ±mÄ±n] ğŸ†š [Rakip] â€” Kadronuzu kontrol edin!"
      - 10 dk: "ğŸ”” MaÃ§Ä±n 10 dakika sonra baÅŸlÄ±yor! [TakÄ±mÄ±n] ğŸ†š [Rakip]"

   b) **matchStarted(matchId):**
      - "â–¶ï¸ MaÃ§ baÅŸladÄ±! [Ev] ğŸ†š [Deplasman] â€” /canli ile izle!"

   c) **goalScored(matchId, scorerName, score):**
      - "âš½ GOOOL! [Oyuncu] â€” [Ev] [skor] [Dep]"

   d) **matchEnded(matchId, result):**
      - "ğŸ MaÃ§ Bitti!\n[Ev] [skor] [Dep]\nâš½ Goller: ...\nğŸ’° KazanÃ§: +5.000"

   e) **transferOffer(fromTeam, toUser, player, price):**
      - "ğŸ“¨ Transfer Teklifi!\n[TakÄ±m] [Oyuncu] iÃ§in ğŸ’°[Fiyat] teklif etti.\n[Kabul] [Red]"

   f) **weeklySalary(userId, totalSalary, success):**
      - BaÅŸarÄ±lÄ±: "ğŸ’° HaftalÄ±k maaÅŸlar Ã¶dendi: -[Tutar]"
      - BaÅŸarÄ±sÄ±z: "âš ï¸ MaaÅŸ Ã¶denemedi! Bakiye yetersiz. OyuncularÄ±nÄ±zÄ±n morali dÃ¼ÅŸtÃ¼!"

   g) **injuryNotification(playerId, duration):**
      - "ğŸ¥ [Oyuncu] sakatlandÄ±! [N] maÃ§ sÃ¼reyle oynayamayacak."

   h) **seasonEnd(userId, rank, prize):**
      - "ğŸ† Sezon Sonu!\nSÄ±ralamanÄ±z: #[rank]\nÃ–dÃ¼l: ğŸ’°[prize]\n[detaylÄ± istatistikler]"

4. **Bildirim Tercihleri:**
   - User.notificationPrefs JSON alanÄ±:
     { matchReminders: true, goals: true, results: true, transfers: true, salaries: true }
   - /ayarlar komutu ile toggle edilebilir
   - GÃ¶nderim Ã¶ncesi tercih kontrolÃ¼ yap</textarea>
<textarea id="prompt-3-3" data-title="PROMPT 3.3 â€” Yeni Oyuncu Dengeleme (Catchup)" style="display:none">Football Manager projesi iÃ§in yeni oyuncu koruma ve dengeleme sistemini yaz.

Dosya: src/services/newPlayerService.ts

Kurallar:
1. Ä°lk 2 hafta (14 gÃ¼n) koruma kalkanÄ± (User.isNewPlayer, User.newPlayerUntil)

2. Koruma sÃ¼resince:
   - MaaÅŸlar %50 indirimli
   - Antrenman Ã¼cretleri %50 indirimli
   - MaÄŸlubiyet baÅŸÄ±na ekstra +2.000 teselli Ã¶dÃ¼lÃ¼
   - Rakip eÅŸleÅŸtirme: OVR farkÄ± max 10 (fikstÃ¼rde kontrol)

3. B Ligi atamasÄ±: Yeni oyuncular otomatik B Ligi'ne

4. Sezon ortasÄ± katÄ±lÄ±m:
   - EÄŸer sezon ortasÄ±ndaysa: Sonraki sezon baÅŸÄ±na kadar sadece dostluk maÃ§larÄ±
   - Dostluk maÃ§lardan da XP ve pasif geliÅŸim kazanÄ±r

5. Koruma sÃ¼resi bitince:
   - isNewPlayer = false
   - Normal ekonomi kurallarÄ± uygulanÄ±r
   - "Koruma kalkanÄ±nÄ±z sona erdi! ArtÄ±k gerÃ§ek bir menajersiniz! ğŸ’ª" bildirimi</textarea>
<textarea id="prompt-4-1" data-title="PROMPT 4.1 â€” API Sunucusu" style="display:none">Football Manager projesi iÃ§in Express API sunucusunu yaz.

Dosyalar:
- src/api/index.ts (Express app + Socket.IO)
- src/api/middleware/auth.ts (JWT auth)
- src/api/routes/teams.ts
- src/api/routes/players.ts
- src/api/routes/leagues.ts
- src/api/routes/matches.ts
- src/api/routes/transfers.ts
- src/api/routes/users.ts

**API Endpoints:**

Auth:
- POST /api/auth/telegram â€” Telegram Login Widget doÄŸrulama â†’ JWT token

Teams:
- GET /api/teams/:id â€” TakÄ±m detayÄ± (oyuncularla birlikte)
- GET /api/teams/:id/squad â€” Kadro (ilk 11 + yedekler)
- PATCH /api/teams/:id/formation â€” Formasyon gÃ¼ncelle
- PATCH /api/teams/:id/tactic â€” Taktik gÃ¼ncelle
- PATCH /api/teams/:id/lineup â€” Kadro dÃ¼zenle (swap)

Players:
- GET /api/players/:id â€” Oyuncu detay
- GET /api/players/:id/stats â€” Oyuncu istatistikleri

Leagues:
- GET /api/leagues/:id â€” Lig bilgisi
- GET /api/leagues/:id/standings â€” Puan tablosu
- GET /api/leagues/:id/fixtures â€” FikstÃ¼r
- GET /api/leagues/:id/results â€” SonuÃ§lar

Matches:
- GET /api/matches/:id â€” MaÃ§ detayÄ± + olaylar
- GET /api/matches/live â€” Åu an oynanan maÃ§lar
- GET /api/matches/upcoming â€” Gelecek maÃ§lar

Transfers:
- GET /api/transfers/market â€” Transfer pazarÄ±
- POST /api/transfers/buy/:playerId â€” Pazar'dan satÄ±n al
- POST /api/transfers/offer â€” Teklif gÃ¶nder
- PATCH /api/transfers/:id/accept â€” Teklif kabul
- PATCH /api/transfers/:id/reject â€” Teklif red

Users:
- GET /api/users/me â€” Kendi profil
- GET /api/users/me/transactions â€” Para hareketleri

Middleware: JWT auth, rate limiting (60/dk), CORS, error handler, request logger.</textarea>
<textarea id="prompt-4-2" data-title="PROMPT 4.2 â€” Socket.IO Match Tracker" style="display:none">Football Manager projesi iÃ§in Socket.IO ile gerÃ§ek zamanlÄ± match tracker yaz.

Dosyalar:
- src/socket/matchTracker.ts
- src/socket/index.ts

**Match Tracker AkÄ±ÅŸÄ±:**

1. MaÃ§ baÅŸladÄ±ÄŸÄ±nda:
   - MatchEngine her tick'te event Ã¼retir
   - Her event Socket.IO ile broadcast edilir
   - Room: "match:{matchId}"

2. **Socket Events:**

   Client â†’ Server:
   - join_match: { matchId } â†’ ilgili odaya katÄ±l
   - leave_match: { matchId } â†’ odadan ayrÄ±l
   - get_live_matches â†’ aktif maÃ§ listesi

   Server â†’ Client:
   - match_tick: { matchId, tick, minute, events[], score, stats }
   - match_event: { matchId, event: MatchEventData }
   - match_start: { matchId, homeTeam, awayTeam }
   - match_halftime: { matchId, score, stats }
   - match_end: { matchId, finalScore, fullStats, manOfTheMatch }
   - live_matches_update: { matches[] }

3. **MaÃ§ Engine Entegrasyonu:**
   - simulateMatch() fonksiyonunu tick-by-tick Ã§alÄ±ÅŸtÄ±r
   - Her tick arasÄ±nda 1 saniye bekle (gerÃ§ek zamanlÄ± izleme)
   - Her tick'te socket event emit et

4. **TG Bot Match Tracker:**
   - MaÃ§ baÅŸÄ±nda mesaj gÃ¶nder
   - Her Ã¶nemli olay: editMessageText ile gÃ¼ncelle
   - Rate limit: min 3 saniye arayla edit
   - Sadece Ã¶nemli olaylar gÃ¼ncellenir: GOL, KART, SAKATLIK, PENALTI, DEVRE, MAÃ‡ SONU
   - Mesaj formatÄ±:</textarea>
<textarea id="prompt-4-3" data-title="PROMPT 4.3 â€” Web Frontend (Next.js)" style="display:none">Football Manager projesi iÃ§in Next.js web arayÃ¼zÃ¼nÃ¼ yaz.

Dizin: web/
Teknoloji: Next.js 14 (App Router), TailwindCSS, Socket.IO Client

**Sayfalar:**

1. **/ (Dashboard):**
   - TakÄ±m Ã¶zeti kartÄ± (isim, OVR, formasyon, taktik)
   - Bakiye ve seviye
   - YaklaÅŸan maÃ§lar (sonraki 3 maÃ§)
   - Son sonuÃ§lar
   - HÄ±zlÄ± aksiyonlar (Antrenman, Transfer, Kadro)

2. **/squad (Kadro):**
   - Formasyon gÃ¶rsel gÃ¶sterimi (saha Ã¼zerinde oyuncular)
   - Ä°lk 11 kartlarÄ± (isim, pozisyon, OVR, kondisyon bar'Ä±)
   - Yedek listesi
   - Drag &amp; drop kadro dÃ¼zenleme
   - Formasyon ve taktik deÄŸiÅŸtirme dropdown'larÄ±

3. **/player/[id] (Oyuncu Detay):**
   - BÃ¼yÃ¼k oyuncu kartÄ± (tÃ¼m statlar radar chart ile)
   - Form grafiÄŸi (son 10 maÃ§)
   - Sezon istatistikleri
   - Antrenman butonu

4. **/league (Lig):**
   - Puan tablosu (renk kodlu: ÅŸampiyon, UCL, kÃ¼me dÃ¼ÅŸme)
   - FikstÃ¼r takvimi
   - MaÃ§ sonuÃ§larÄ±

5. **/match/[id] (Match Tracker):**
   - CanlÄ± skor (bÃ¼yÃ¼k, ortada)
   - Dakika sayacÄ±
   - Olay akÄ±ÅŸÄ± (timeline, yukarÄ±dan aÅŸaÄŸÄ±)
   - TakÄ±m istatistikleri (possession bar, ÅŸut, faul vb.)
   - EÄŸer maÃ§ bitmiÅŸse: Tam istatistik + maÃ§Ä±n adamÄ±

6. **/transfers (Transfer PazarÄ±):**
   - Filtreler: Pozisyon, OVR aralÄ±ÄŸÄ±, fiyat aralÄ±ÄŸÄ±
   - Oyuncu kartlarÄ± grid
   - SatÄ±n al butonu
   - Gelen/giden teklifler listesi

7. **/profile (Profil):**
   - Seviye ve XP bar'Ä±
   - Sezon istatistikleri
   - BaÅŸarÄ±lar (achievements)
   - Para hareketleri

**Ortak BileÅŸenler:**
- Navbar (logo, sayfalar, bakiye, bildirimler)
- PlayerCard component
- MatchScore component
- StandingsTable component
- Loading/Error states
- Telegram Login butonu (auth)
- Socket.IO provider (global connection)

TasarÄ±m: Koyu tema, futbol temalÄ± yeÅŸil aksanlar, modern ve responsive.
TailwindCSS kullanarak mobil Ã¶ncelikli tasarÄ±m.</textarea>
<textarea id="prompt-5-1" data-title="PROMPT 5.1 â€” Åampiyonlar Ligi &amp; Kupa" style="display:none">Football Manager projesi iÃ§in Åampiyonlar Ligi ve Kupa turnuva sistemini yaz.

Dosyalar:
- src/engine/tournamentManager.ts
- src/services/tournamentService.ts

**Åampiyonlar Ligi:**

1. KatÄ±lÄ±m: A Ligi ilk 4 takÄ±m
2. Format:
   - Grup aÅŸamasÄ±: 2 grup Ã— 4 takÄ±m, Ã§ift devreli (her takÄ±m 6 maÃ§)
   - Her gruptan ilk 2 â†’ yarÄ± final
   - YarÄ± final: Tek maÃ§
   - Final: Tek maÃ§ (Pazar 18:00)
3. Ã–dÃ¼ller: Åampiyon 200K, Finalist 100K, YarÄ± finalist 50K, Gruptan Ã§Ä±kamayan 20K
4. MaÃ§ gÃ¼nleri: Pazar 18:00

**Kupa TurnuvasÄ±:**
1. TÃ¼m takÄ±mlar katÄ±lÄ±r (A + B Ligi)
2. Knockout (tek maÃ§ eleme)
3. Kura: Pot sistemi (A Ligi = Pot 1, B Ligi = Pot 2)
4. Final Ã¶dÃ¼lÃ¼: 75K
5. Sezon sonu: SÃ¼per Kupa (Lig ÅŸampiyonu vs Kupa ÅŸampiyonu)

**TournamentManager:**
- createChampionsLeague(seasonId, qualifiedTeamIds[])
- createCup(seasonId, allTeamIds[])
- drawGroups(teamIds, groupCount)
- drawKnockout(teamIds, pots?)
- advanceRound(tournamentId)
- getTournamentBracket(tournamentId)</textarea>
<textarea id="prompt-5-2" data-title="PROMPT 5.2 â€” Sosyal Ã–zellikler" style="display:none">Football Manager projesi iÃ§in sosyal Ã¶zellikleri yaz.

**1. Dostluk MaÃ§Ä±:**
- /dostlukmaci @rakip_username
- GÃ¼nde max 3 dostluk maÃ§Ä±
- Puan tablosunu etkilemez
- XP ve pasif geliÅŸim verir
- SonuÃ§: Normal maÃ§ simÃ¼lasyonu

**2. Lig Sohbet Grubu:**
- Her lig iÃ§in otomatik TG grubu oluÅŸtur
- MaÃ§ sonuÃ§larÄ± otomatik paylaÅŸÄ±lÄ±r
- HaftalÄ±k Ã¶zet mesajÄ± (puan tablosu + haftanÄ±n sonuÃ§larÄ±)

**3. MVP OylamasÄ±:**
- Her hafta sonu: HaftanÄ±n en iyi performans gÃ¶steren oyuncularÄ± listelenir
- Lig Ã¼yeleri oy verir (inline keyboard)
- Kazanan oyuncunun takÄ±mÄ±na +5 moral tÃ¼m kadro
- /mvp komutu

**4. All-Star MaÃ§Ä±:**
- Sezon sonunda: A Ligi en iyi 11 vs B Ligi en iyi 11
- EÄŸlence maÃ§Ä±, Ã¶dÃ¼l yok, sadece prestij

**5. Liderlik TablolarÄ±:**
- /golkrali: Sezon gol sÄ±ralamasÄ±
- /asistkrali: Sezon asist sÄ±ralamasÄ±
- /eniyitakim: TakÄ±m OVR sÄ±ralamasÄ±
- /liderlik: Genel liderlik tablosu

**6. BaÅŸarÄ± Sistemi:**
- 20+ baÅŸarÄ±: Ä°lk galibiyet, 10 galibiyet, 50 gol, 5 galibiyet serisi, ÅŸampiyonluk, UCL kazanma, 100K coin biriktirme vb.
- Her baÅŸarÄ± XP + coin Ã¶dÃ¼lÃ¼</textarea>
<textarea id="prompt-6-1" data-title="PROMPT 6.1 â€” Anti-Cheat &amp; GÃ¼venlik" style="display:none">Football Manager projesi iÃ§in anti-cheat ve gÃ¼venlik Ã¶nlemlerini yaz.

Dosya: src/services/antiCheatService.ts

**Kurallar:**
1. Ã‡oklu hesap: TG hesap yaÅŸÄ± &lt; 7 gÃ¼n â†’ kayÄ±t engeli
2. IP kontrolÃ¼: Web'de aynÄ± IP'den max 2 hesap
3. Transfer suistimali: Piyasa deÄŸerinin %50 altÄ±na satÄ±ÅŸ â†’ otomatik blok
4. AynÄ± 2 kiÅŸi arasÄ±nda gÃ¼nde max 1 transfer
5. Rate limiting: Dakikada max 30 API Ã§aÄŸrÄ±sÄ± per kullanÄ±cÄ±
6. Bot davranÄ±ÅŸ tespiti: Anormal aktivite pattern'i (1 dk'da 50+ komut)

**Ceza Sistemi:**
- 1. ihlal: UyarÄ± mesajÄ±
- 2. ihlal: 3 gÃ¼n ban (tÃ¼m komutlar kilitlenir)
- 3. ihlal: Sezon sonu hesap silme

**Loglama:**
- Her transfer, her bÃ¼yÃ¼k para hareketi loglanÄ±r
- ÅÃ¼pheli aktiviteler ayrÄ± log dosyasÄ±na
- HaftalÄ±k otomatik rapor (admin'e)</textarea>
<textarea id="prompt-6-2" data-title="PROMPT 6.2 â€” Veri Yedekleme &amp; Deployment" style="display:none">Football Manager projesi iÃ§in yedekleme ve deployment yapÄ±landÄ±rmasÄ±nÄ± yaz.

**Yedekleme:**
1. PostgreSQL WAL: continuous archiving, 7 gÃ¼n retention
2. GÃ¼nlÃ¼k pg_dump: Cron 04:00, sÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ SQL â†’ /backups/ dizini
3. Redis RDB: 15 dakikada bir snapshot
4. Kurtarma prosedÃ¼rÃ¼ dokÃ¼mantasyonu

**Deployment:**
1. VPS: 2 vCPU, 4GB RAM, Ubuntu 22.04
2. Docker Compose production yapÄ±sÄ±:
   - PostgreSQL 16 + Redis 7 + Node.js app
3. PM2 process manager:
   - pm2.config.js: Bot + API + Worker sÃ¼reÃ§leri
   - Auto-restart, memory limit, log rotation
4. Nginx reverse proxy:
   - SSL (Let's Encrypt)
   - WebSocket proxy (Socket.IO iÃ§in)
   - Static file serving (Next.js build)
5. Monitoring:
   - pm2 monit
   - Basit health check endpoint (/api/health)

**Performans:**
1. Redis cache: Puan tablosu (TTL: 60s), oyuncu detay (TTL: 30s)
2. DB indexleri: Match.scheduledAt, Player.teamId, LeagueTeam.leagueId, Transfer.status
3. Connection pooling: Prisma default pool</textarea>
<textarea id="prompt-6-3" data-title="PROMPT 6.3 â€” Ekonomi Dengeleme &amp; Son Testler" style="display:none">Football Manager projesi iÃ§in ekonomi dengeleme testi ve son dokunuÅŸlarÄ± yaz.

**SimÃ¼lasyon Testi:**
25-30 yapay takÄ±m oluÅŸtur ve 2 sezon simÃ¼le et.
Kontrol listesi:
1. Ortalama takÄ±m bakiyesi sezon sonunda pozitif mi?
2. En zengin ve en fakir arasÄ±ndaki fark makul mÃ¼? (max 5x)
3. Transfer pazarÄ±nda enflasyon var mÄ±? (ortalama fiyat artÄ±ÅŸÄ± &lt; %20/sezon)
4. MaaÅŸ toplamÄ± gelirlerden dÃ¼ÅŸÃ¼k mÃ¼? (sÃ¼rdÃ¼rÃ¼lebilir)
5. Yeni oyuncu 4 hafta sonra rekabetÃ§i olabiliyor mu?
6. 34+ yaÅŸ oyuncular doÄŸal olarak deÄŸer kaybediyor mu?

**Ayarlama:**
Dengesizlik varsa ÅŸu parametreleri ayarla:
- MaÃ§ Ã¶dÃ¼lleri (5K/2K/500)
- MaaÅŸ Ã§arpanÄ± (0.02)
- Antrenman maliyetleri
- Transfer NPC fiyatlarÄ±
- Stadyum bakÄ±m Ã¼creti

**Son DokunuÅŸlar:**
1. TÃ¼m hata mesajlarÄ±nÄ± TÃ¼rkÃ§eleÅŸtir
2. Bot komut listesini BotFather'a kaydet
3. README.md gÃ¼ncelle (son kurulum adÄ±mlarÄ±)
4. KullanÄ±cÄ± geri bildirim toplama: /geribildirm komutu</textarea>
<textarea id="prompt-hata-ayiklama" data-title="Hata AyÄ±klama" style="display:none">Football Manager projesinde [MODÃœL] bÃ¶lÃ¼mÃ¼nde ÅŸu hata var:
[HATA MESAJI]

Mevcut kod: [KOD]

Bu hatayÄ± dÃ¼zelt. DÃ¼zeltirken:
1. HatanÄ±n kÃ¶k nedenini aÃ§Ä±kla
2. DÃ¼zeltme kodunu yaz
3. Benzer hatalarÄ± Ã¶nlemek iÃ§in ek kontroller Ã¶ner</textarea>
<textarea id="prompt-yeni-ozellik-ekleme" data-title="Yeni Ã–zellik Ekleme" style="display:none">Football Manager projesine yeni bir Ã¶zellik eklemek istiyorum:
[Ã–ZELLÄ°K AÃ‡IKLAMASI]

Mevcut yapÄ±:
- src/engine/ â€” MaÃ§ motoru, oyuncu oluÅŸturma
- src/services/ â€” Ä°ÅŸ mantÄ±ÄŸÄ± servisleri
- src/bot/ â€” Telegram bot komutlarÄ±
- src/api/ â€” REST API
- prisma/schema.prisma â€” VeritabanÄ± modelleri

Bu Ã¶zelliÄŸi:
1. Hangi dosyalara eklenmeli?
2. DB schema deÄŸiÅŸikliÄŸi gerekiyor mu?
3. Yeni endpoint/komut gerekiyor mu?
4. Mevcut sisteme etkisi ne?

Kodu yaz ve mevcut yapÄ±ya entegre et.</textarea>
<textarea id="prompt-performans-iÌ‡yileÅŸtirme" data-title="Performans Ä°yileÅŸtirme" style="display:none">Football Manager projesinde [BÃ–LÃœM] yavaÅŸ Ã§alÄ±ÅŸÄ±yor.

Mevcut durum: [AÃ‡IKLAMA]
Beklenen: [HEDEF]

Optimize et:
1. Database sorgu optimizasyonu (N+1 problemi, index eksikliÄŸi)
2. Redis cache ekleme
3. Bulk iÅŸlem kullanma
4. Gereksiz DB Ã§aÄŸrÄ±larÄ±nÄ± kaldÄ±rma</textarea>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROMPT MAP â€” Category â†’ Prompt ID
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROMPT_MAP = {
  "faz0-GeliÅŸtirme OrtamÄ±": "prompt-0-1",
  "faz0-AltyapÄ± Servisleri": "prompt-0-2",
  "faz0-Temel Bot Kurulumu": "prompt-0-3",
  "faz1-VeritabanÄ± ÅemasÄ±": "prompt-1-1",
  "faz1-Oyuncu OluÅŸturma Sistemi": "prompt-1-2",
  "faz1-Starter Pack & Onboarding": "prompt-1-2",
  "faz1-Telegram Bot â€” KayÄ±t & TakÄ±m": "prompt-1-3",
  "faz1-MaÃ§ SimÃ¼lasyon Motoru (Temel)": "prompt-1-4",
  "faz1-Basit Lig Sistemi": "prompt-1-5",
  "faz2-Ekonomi Sistemi": "prompt-2-1",
  "faz2-Transfer PazarÄ±": "prompt-2-2",
  "faz2-Antrenman Sistemi": "prompt-2-3",
  "faz2-Seviye Sistemi": "prompt-2-4",
  "faz2-SakatlÄ±k & Kart DetayÄ±": "prompt-2-3",
  "faz2-AntrenÃ¶r Sistemi": "prompt-2-3",
  "faz3-Lig YapÄ±sÄ±": "prompt-3-1",
  "faz3-Sezon DÃ¶ngÃ¼sÃ¼": "prompt-3-1",
  "faz3-Otomatik MaÃ§ Zamanlama": "prompt-3-1",
  "faz3-Bildirim Sistemi": "prompt-3-2",
  "faz3-Yeni Oyuncu Dengeleme": "prompt-3-3",
  "faz4-API Sunucusu": "prompt-4-1",
  "faz4-Socket.IO â€” GerÃ§ek ZamanlÄ±": "prompt-4-2",
  "faz4-Web ArayÃ¼zÃ¼ (Next.js)": "prompt-4-3",
  "faz4-Ä°statistik SayfalarÄ±": "prompt-4-3",
  "faz5-Åampiyonlar Ligi": "prompt-5-1",
  "faz5-Kupa TurnuvasÄ±": "prompt-5-1",
  "faz5-Sosyal Ã–zellikler": "prompt-5-2",
  "faz5-Liderlik TablolarÄ±": "prompt-5-2",
  "faz6-Anti-Cheat & GÃ¼venlik": "prompt-6-1",
  "faz6-Veri Yedekleme": "prompt-6-2",
  "faz6-Performans & Ã–lÃ§ekleme": "prompt-6-2",
  "faz6-Son DokunuÅŸlar": "prompt-6-3"
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROJECT DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROJECT = [
  {
    id: "faz0",
    phase: "Faz 0",
    title: "Proje AltyapÄ±sÄ± & Kurulum",
    icon: "ğŸ—ï¸",
    color: "#64748b",
    colorRGB: "100,116,139",
    desc: "Hafta 0",
    categories: [
      {
        name: "GeliÅŸtirme OrtamÄ±",
        tasks: [
          { id: "f0-01", text: "Node.js, TypeScript, npm kurulumu ve yapÄ±landÄ±rma", tags: ["critical"] },
          { id: "f0-02", text: "Git repo oluÅŸturma, .gitignore, branch stratejisi belirleme", tags: ["critical"] },
          { id: "f0-03", text: "ESLint + Prettier konfigÃ¼rasyonu", tags: ["normal"] },
          { id: "f0-04", text: "Monorepo yapÄ±sÄ± kurulumu (src/bot, src/api, src/engine, src/shared, web/)", tags: ["important"] },
          { id: "f0-05", text: "tsconfig.json ve path alias ayarlarÄ± (@shared, @engine, @bot vb.)", tags: ["normal"] },
        ]
      },
      {
        name: "AltyapÄ± Servisleri",
        tasks: [
          { id: "f0-06", text: "Docker Compose: PostgreSQL 16 + Redis 7 container kurulumu", tags: ["critical", "db"] },
          { id: "f0-07", text: "Prisma ORM kurulumu ve baÄŸlantÄ± testi", tags: ["critical", "db"] },
          { id: "f0-08", text: "Redis (ioredis) baÄŸlantÄ± testi", tags: ["important", "db"] },
          { id: "f0-09", text: "BullMQ kuyruk sistemi kurulumu ve baÄŸlantÄ± testi", tags: ["important"] },
          { id: "f0-10", text: "Winston logger yapÄ±landÄ±rmasÄ± (dosya + konsol)", tags: ["normal"] },
          { id: "f0-11", text: ".env dosyasÄ± ve environment config modÃ¼lÃ¼", tags: ["critical"] },
        ]
      },
      {
        name: "Temel Bot Kurulumu",
        tasks: [
          { id: "f0-12", text: "Telegram BotFather Ã¼zerinden bot oluÅŸturma ve token alma", tags: ["critical", "bot"] },
          { id: "f0-13", text: "grammy framework kurulumu ve basit /start komutu testi", tags: ["critical", "bot"] },
          { id: "f0-14", text: "Bot middleware yapÄ±sÄ± (session, error handler, logger)", tags: ["important", "bot"] },
        ]
      }
    ]
  },
  {
    id: "faz1",
    phase: "Faz 1",
    title: "Temel Oyun MekaniÄŸi (MVP)",
    icon: "ğŸ”µ",
    color: "#3b82f6",
    colorRGB: "59,130,246",
    desc: "Hafta 1-3",
    categories: [
      {
        name: "VeritabanÄ± ÅemasÄ±",
        tasks: [
          { id: "f1-01", text: "User modeli: tg_id, username, level, xp, coins, created_at", tags: ["critical", "db"] },
          { id: "f1-02", text: "Team modeli: user_id, name, formation, tactic, power_rating", tags: ["critical", "db"] },
          { id: "f1-03", text: "Player modeli: 7 ana stat (spd/sht/pas/drb/def/phy/ref) + 4 dinamik stat", tags: ["critical", "db"] },
          { id: "f1-04", text: "Player meta: yaÅŸ, pozisyon, alternatif pozisyon, piyasa deÄŸeri, maaÅŸ, overall", tags: ["critical", "db"] },
          { id: "f1-05", text: "League modeli: name, season, status, type (A/B)", tags: ["important", "db"] },
          { id: "f1-06", text: "LeagueTeam (lig-takÄ±m iliÅŸkisi): puan, galibiyet, beraberlik, maÄŸlubiyet, AG, YG", tags: ["important", "db"] },
          { id: "f1-07", text: "Match modeli: home/away team, scheduled_at, status, skor", tags: ["critical", "db"] },
          { id: "f1-08", text: "MatchEvent modeli: dakika, olay tipi, oyuncu, detay", tags: ["important", "db"] },
          { id: "f1-09", text: "Prisma migration Ã§alÄ±ÅŸtÄ±r ve doÄŸrula", tags: ["critical", "db"] },
        ]
      },
      {
        name: "Oyuncu OluÅŸturma Sistemi",
        tasks: [
          { id: "f1-10", text: "Rastgele futbolcu Ã¼retim fonksiyonu (pozisyon bazlÄ± stat daÄŸÄ±lÄ±mÄ±)", tags: ["critical", "engine"] },
          { id: "f1-11", text: "Pozisyona gÃ¶re aÄŸÄ±rlÄ±klÄ± overall hesaplama formÃ¼lÃ¼ (GK, CB, ST vb.)", tags: ["critical", "engine"] },
          { id: "f1-12", text: "Rastgele isim havuzu (TÃ¼rkÃ§e isim/soyisim listesi)", tags: ["normal"] },
          { id: "f1-13", text: "YaÅŸ bazlÄ± stat daÄŸÄ±lÄ±m kurallarÄ±", tags: ["important", "engine"] },
          { id: "f1-14", text: "Piyasa deÄŸeri hesaplama fonksiyonu (stat Ã— yaÅŸ Ã— form Ã§arpanÄ±)", tags: ["important", "engine"] },
          { id: "f1-15", text: "MaaÅŸ hesaplama fonksiyonu (piyasa deÄŸeri Ã— 0.02)", tags: ["normal", "engine"] },
        ]
      },
      {
        name: "Starter Pack & Onboarding",
        tasks: [
          { id: "f1-16", text: "18 futbolculuk starter pack Ã¼retici (pozisyon daÄŸÄ±lÄ±mlÄ±)", tags: ["critical", "engine"] },
          { id: "f1-17", text: "Starter OVR aralÄ±ÄŸÄ±: 45-60, 1 yÄ±ldÄ±z oyuncu 65-70 garantisi", tags: ["important", "engine"] },
          { id: "f1-18", text: "BaÅŸlangÄ±Ã§ bakiye: 50.000 coin atamasÄ±", tags: ["normal"] },
        ]
      },
      {
        name: "Telegram Bot â€” KayÄ±t & TakÄ±m",
        tasks: [
          { id: "f1-19", text: "/start komutu: KullanÄ±cÄ± kaydÄ± + hoÅŸ geldin mesajÄ±", tags: ["critical", "bot"] },
          { id: "f1-20", text: "TakÄ±m oluÅŸturma akÄ±ÅŸÄ±: Ä°sim girme â†’ Starter pack atama â†’ Onay", tags: ["critical", "bot"] },
          { id: "f1-21", text: "Inline keyboard: Ana menÃ¼ (Kadro, Antrenman, Lig, Transfer, Profil)", tags: ["critical", "bot"] },
          { id: "f1-22", text: "/kadro komutu: Ä°lk 11 + yedekleri listele", tags: ["important", "bot"] },
          { id: "f1-23", text: "/oyuncu [isim] komutu: DetaylÄ± futbolcu kartÄ± gÃ¶ster", tags: ["important", "bot"] },
          { id: "f1-24", text: "Formasyon seÃ§imi: 6 formasyon inline butonlarla gÃ¶ster ve seÃ§", tags: ["important", "bot"] },
          { id: "f1-25", text: "Taktik seÃ§imi: HÃ¼cum/Dengeli/Defansif/TÃ¼m GÃ¼Ã§ HÃ¼cum", tags: ["important", "bot"] },
          { id: "f1-26", text: "Kadro dÃ¼zenleme: Oyuncu yer deÄŸiÅŸtir (asil â†” yedek)", tags: ["important", "bot"] },
          { id: "f1-27", text: "NasÄ±l OynanÄ±r rehberi: 5 adÄ±mlÄ±k interaktif tur + 5.000 coin Ã¶dÃ¼l", tags: ["normal", "bot"] },
        ]
      },
      {
        name: "MaÃ§ SimÃ¼lasyon Motoru (Temel)",
        tasks: [
          { id: "f1-28", text: "Tick sistemi: 60 tick = 1 maÃ§ = 90 dk oyun sÃ¼resi", tags: ["critical", "engine"] },
          { id: "f1-29", text: "Etkin Overall hesaplama: Overall Ã— (MoralÃ—0.15 + FormÃ—0.25 + KondisyonÃ—0.60)", tags: ["critical", "engine"] },
          { id: "f1-30", text: "Formasyon bonus sistemi (hÃ¼cum/orta saha/defans %'leri)", tags: ["important", "engine"] },
          { id: "f1-31", text: "Taktik bonus sistemi (hÃ¼cum +15/-10, defansif -10/+15 vb.)", tags: ["important", "engine"] },
          { id: "f1-32", text: "Olay olasÄ±lÄ±k tablosu: %35 olay/tick, olay tipi daÄŸÄ±lÄ±mlarÄ±", tags: ["critical", "engine"] },
          { id: "f1-33", text: "Gol olasÄ±lÄ±k formÃ¼lÃ¼: ÅŸut_gÃ¼cÃ¼ vs kurtarÄ±ÅŸ_gÃ¼cÃ¼ + random factor", tags: ["critical", "engine"] },
          { id: "f1-34", text: "Faul, sarÄ± kart, kÄ±rmÄ±zÄ± kart olaylarÄ±", tags: ["important", "engine"] },
          { id: "f1-35", text: "SakatlÄ±k olay sistemi (hafif %8, orta %3, aÄŸÄ±r %1 Ã— PHY direnci)", tags: ["important", "engine"] },
          { id: "f1-36", text: "Ev sahibi avantajÄ±: +3 bonus", tags: ["normal", "engine"] },
          { id: "f1-37", text: "TakÄ±m gÃ¼cÃ¼ farkÄ± etkisi: her 5 puan = %8 lehine dÃ¶nÃ¼ÅŸÃ¼m", tags: ["important", "engine"] },
          { id: "f1-38", text: "MaÃ§ sonucu kaydetme (skor, olaylar, istatistikler DB'ye)", tags: ["critical", "engine"] },
          { id: "f1-39", text: "MaÃ§ sonrasÄ± stat gÃ¼ncellemeleri (kondisyon, pasif geliÅŸim, moral)", tags: ["important", "engine"] },
          { id: "f1-40", text: "MaÃ§ sonucu Telegram bildirim mesajÄ±", tags: ["important", "bot"] },
        ]
      },
      {
        name: "Basit Lig Sistemi",
        tasks: [
          { id: "f1-41", text: "FikstÃ¼r oluÅŸturma algoritmasÄ± (round-robin)", tags: ["critical", "engine"] },
          { id: "f1-42", text: "Puan tablosu hesaplama (G=3, B=1, M=0) ve sÄ±ralama", tags: ["critical", "engine"] },
          { id: "f1-43", text: "/ligtablosu komutu: Puan tablosu gÃ¶ster", tags: ["important", "bot"] },
          { id: "f1-44", text: "/fikstur komutu: Gelecek maÃ§lar listesi", tags: ["important", "bot"] },
          { id: "f1-45", text: "/sonuclar komutu: Son oynanan maÃ§ sonuÃ§larÄ±", tags: ["normal", "bot"] },
        ]
      }
    ]
  },
  {
    id: "faz2",
    phase: "Faz 2",
    title: "Ekonomi & GeliÅŸim",
    icon: "ğŸŸ¢",
    color: "#10b981",
    colorRGB: "16,185,129",
    desc: "Hafta 4-5",
    categories: [
      {
        name: "Ekonomi Sistemi",
        tasks: [
          { id: "f2-01", text: "MaÃ§ Ã¶dÃ¼lleri: Galibiyet 5K, Beraberlik 2K, MaÄŸlubiyet 500", tags: ["critical", "engine"] },
          { id: "f2-02", text: "HaftalÄ±k otomatik maaÅŸ kesimi (tÃ¼m kadro maaÅŸ toplamÄ±)", tags: ["critical", "engine"] },
          { id: "f2-03", text: "MaaÅŸ Ã¶denmezse moral -30 cezasÄ±", tags: ["important", "engine"] },
          { id: "f2-04", text: "Stadyum bakÄ±m Ã¼creti: HaftalÄ±k 5.000", tags: ["important", "engine"] },
          { id: "f2-05", text: "GÃ¼nlÃ¼k giriÅŸ Ã¶dÃ¼lÃ¼: 1.000 coin (/gunluk komutu)", tags: ["normal", "bot"] },
          { id: "f2-06", text: "Bakiye gÃ¶sterimi ve gelir/gider geÃ§miÅŸi", tags: ["normal", "bot"] },
          { id: "f2-07", text: "Ekonomi denge kontrolÃ¼: Enflasyon testi (25-30 oyuncuyla simÃ¼lasyon)", tags: ["important", "engine"] },
        ]
      },
      {
        name: "Transfer PazarÄ±",
        tasks: [
          { id: "f2-08", text: "Transfer pazarÄ±: Sistem tarafÄ±ndan Ã¼retilen NPC oyuncular", tags: ["critical", "engine"] },
          { id: "f2-09", text: "Oyuncular arasÄ± transfer teklifi gÃ¶nder/al mekanizmasÄ±", tags: ["important", "bot"] },
          { id: "f2-10", text: "Transfer fiyat hesabÄ±: Piyasa deÄŸeri + talep Ã§arpanÄ±", tags: ["important", "engine"] },
          { id: "f2-11", text: "Transfer vergisi: DÃ¼ÅŸÃ¼k ligden alÄ±mda +%50 fiyat farkÄ±", tags: ["normal", "engine"] },
          { id: "f2-12", text: "Yeni oyuncu ilk hafta transfer engeli", tags: ["normal", "engine"] },
          { id: "f2-13", text: "Anti-abuse: AynÄ± 2 kullanÄ±cÄ± arasÄ±nda gÃ¼nde max 1 transfer", tags: ["important", "engine"] },
          { id: "f2-14", text: "Transfer modeli: from_team, to_team, player, price, timestamp â†’ DB", tags: ["important", "db"] },
          { id: "f2-15", text: "/transfer komutu: PazarÄ± gÃ¶r, teklif gÃ¶nder, kabul/red", tags: ["critical", "bot"] },
        ]
      },
      {
        name: "Antrenman Sistemi",
        tasks: [
          { id: "f2-16", text: "Pasif geliÅŸim: MaÃ§ sonrasÄ± oynayan oyunculara +0.1-0.3 rastgele stat", tags: ["critical", "engine"] },
          { id: "f2-17", text: "Aktif antrenman seÃ§enekleri: Kondisyon/Teknik/Taktik/Fizik/GK kamplarÄ±", tags: ["critical", "engine"] },
          { id: "f2-18", text: "YoÄŸun Kamp (5K, +1.0 stat) ve Elit Kamp (10K, +1.0Ã—2 stat)", tags: ["important", "engine"] },
          { id: "f2-19", text: "Antrenman cooldown sistemi (12-48 saat arasÄ±)", tags: ["important", "engine"] },
          { id: "f2-20", text: "YaÅŸ bazlÄ± geliÅŸim Ã§arpanÄ± (17-21: Ã—1.5, 34+: gerileme)", tags: ["critical", "engine"] },
          { id: "f2-21", text: "Catchup mekanizmasÄ±: DÃ¼ÅŸÃ¼k OVR daha hÄ±zlÄ± geliÅŸir (40-55: Ã—2.0)", tags: ["important", "engine"] },
          { id: "f2-22", text: "/antrenman komutu: Oyuncu seÃ§, kamp tÃ¼rÃ¼ seÃ§, baÅŸlat", tags: ["critical", "bot"] },
        ]
      },
      {
        name: "Seviye Sistemi",
        tasks: [
          { id: "f2-23", text: "XP kazanma kurallarÄ±: MaÃ§ oyna, gol at, kazandÄ±r, antrenman yap", tags: ["critical", "engine"] },
          { id: "f2-24", text: "Seviye formÃ¼lÃ¼: Her seviye artan XP gereksinimi", tags: ["important", "engine"] },
          { id: "f2-25", text: "Seviye atlama Ã¶dÃ¼lÃ¼: 5.000 Ã— seviye coin", tags: ["normal", "engine"] },
          { id: "f2-26", text: "Seviye kilitleri: Belli Ã¶zelliklerin seviye ile aÃ§Ä±lmasÄ±", tags: ["important", "engine"] },
          { id: "f2-27", text: "/profil komutu: Seviye, XP, istatistikler, baÅŸarÄ±lar", tags: ["important", "bot"] },
        ]
      },
      {
        name: "SakatlÄ±k & Kart DetayÄ±",
        tasks: [
          { id: "f2-28", text: "SakatlÄ±k sÃ¼releri: Hafif 1 maÃ§, Orta 2-3, AÄŸÄ±r 4-6", tags: ["important", "engine"] },
          { id: "f2-29", text: "HÄ±zlÄ± iyileÅŸme mekanizmasÄ± (coin ile sÃ¼re kÄ±saltma)", tags: ["normal", "engine"] },
          { id: "f2-30", text: "KÃ¼mÃ¼latif sarÄ± kart: Her 5 sarÄ± = 1 maÃ§ ceza", tags: ["important", "engine"] },
          { id: "f2-31", text: "KÄ±rmÄ±zÄ± kart: AnÄ±nda atÄ±lma + 1 maÃ§ ceza", tags: ["important", "engine"] },
          { id: "f2-32", text: "Kondisyon < 30 â†’ sakatlÄ±k riski Ã—2, < 15 â†’ Ã—3", tags: ["normal", "engine"] },
        ]
      },
      {
        name: "AntrenÃ¶r Sistemi",
        tasks: [
          { id: "f2-33", text: "Bronz/GÃ¼mÃ¼ÅŸ/AltÄ±n antrenÃ¶r: 7 gÃ¼nlÃ¼k geÃ§ici buff", tags: ["normal", "engine"] },
          { id: "f2-34", text: "/antrenor komutu: AntrenÃ¶r kirala, aktif antrenÃ¶r gÃ¶ster", tags: ["normal", "bot"] },
        ]
      }
    ]
  },
  {
    id: "faz3",
    phase: "Faz 3",
    title: "Lig & Zamanlama Sistemi",
    icon: "ğŸŸ¡",
    color: "#f59e0b",
    colorRGB: "245,158,11",
    desc: "Hafta 6-7",
    categories: [
      {
        name: "Lig YapÄ±sÄ±",
        tasks: [
          { id: "f3-01", text: "2 lig sistemi: A Ligi (Ã¼st) + B Ligi (alt), her biri ~13-15 takÄ±m", tags: ["critical", "engine"] },
          { id: "f3-02", text: "Dinamik lig atamasÄ±: Yeni oyuncular â†’ B Ligi", tags: ["important", "engine"] },
          { id: "f3-03", text: "Relegation/Promotion: A son 2 â†’ B'ye, B ilk 2 â†’ A'ya", tags: ["critical", "engine"] },
          { id: "f3-04", text: "Sezon modeli: season number, start_date, end_date, status â†’ DB", tags: ["important", "db"] },
        ]
      },
      {
        name: "Sezon DÃ¶ngÃ¼sÃ¼",
        tasks: [
          { id: "f3-05", text: "8 haftalÄ±k sezon: 7 hafta lig + 1 hafta transfer dÃ¶nemi", tags: ["critical", "engine"] },
          { id: "f3-06", text: "Sezon baÅŸlangÄ±Ã§: FikstÃ¼r oluÅŸtur, takÄ±mlarÄ± sÄ±fÄ±rla, lige ata", tags: ["critical", "engine"] },
          { id: "f3-07", text: "Sezon sonu: Ã–dÃ¼lleri daÄŸÄ±t, kÃ¼me dÃ¼ÅŸme/Ã§Ä±kma uygula", tags: ["critical", "engine"] },
          { id: "f3-08", text: "Sezon sonu Ã¶dÃ¼lleri: Åampiyon 100K, 2. 60K, 3. 35K", tags: ["important", "engine"] },
          { id: "f3-09", text: "Transfer dÃ¶nemi: Sezon arasÄ± 1 hafta serbest transfer", tags: ["important", "engine"] },
        ]
      },
      {
        name: "Otomatik MaÃ§ Zamanlama",
        tasks: [
          { id: "f3-10", text: "node-cron: Ã‡arÅŸamba + Cuma 20:00 maÃ§ gÃ¼nleri zamanlayÄ±cÄ±", tags: ["critical", "engine"] },
          { id: "f3-11", text: "BullMQ: MaÃ§ kuyruÄŸu, 5'er dakika aralÄ±kla maÃ§ baÅŸlat", tags: ["critical", "engine"] },
          { id: "f3-12", text: "MaÃ§ Ã¶ncesi kontrol: Minimum gÃ¼Ã§ seviyesi, kadro yeterliliÄŸi", tags: ["important", "engine"] },
          { id: "f3-13", text: "Kadro eksikse otomatik yedek atamasÄ±", tags: ["normal", "engine"] },
          { id: "f3-14", text: "Sakatlar ve cezalÄ±lar otomatik kadro dÄ±ÅŸÄ±", tags: ["important", "engine"] },
        ]
      },
      {
        name: "Bildirim Sistemi",
        tasks: [
          { id: "f3-15", text: "MaÃ§ 1 saat kala TG bildirim", tags: ["important", "bot"] },
          { id: "f3-16", text: "MaÃ§ 10 dk kala TG bildirim", tags: ["important", "bot"] },
          { id: "f3-17", text: "MaÃ§ baÅŸladÄ± bildirimi (DM + grup)", tags: ["important", "bot"] },
          { id: "f3-18", text: "MaÃ§ bitti bildirimi + skor Ã¶zeti", tags: ["important", "bot"] },
          { id: "f3-19", text: "HaftalÄ±k maaÅŸ kesildi bildirimi", tags: ["normal", "bot"] },
          { id: "f3-20", text: "Sezon sonu rapor bildirimi", tags: ["normal", "bot"] },
          { id: "f3-21", text: "Bildirim tercih sistemi: Oyuncu hangi bildirimleri alacaÄŸÄ±nÄ± seÃ§er", tags: ["normal", "bot"] },
        ]
      },
      {
        name: "Yeni Oyuncu Dengeleme",
        tasks: [
          { id: "f3-22", text: "Yeni oyuncu koruma kalkanÄ±: Ä°lk 2 hafta %50 indirimli", tags: ["important", "engine"] },
          { id: "f3-23", text: "MaÄŸlubiyet teselli Ã¶dÃ¼lÃ¼: Ä°lk 2 hafta ekstra 2.000 coin", tags: ["normal", "engine"] },
          { id: "f3-24", text: "Sezon ortasÄ± katÄ±lÄ±m: Sonraki sezon baÅŸÄ±na kadar dostluk maÃ§larÄ±", tags: ["normal", "engine"] },
        ]
      }
    ]
  },
  {
    id: "faz4",
    phase: "Faz 4",
    title: "Match Tracker & Web ArayÃ¼zÃ¼",
    icon: "ğŸ”´",
    color: "#ef4444",
    colorRGB: "239,68,68",
    desc: "Hafta 8-10",
    categories: [
      {
        name: "API Sunucusu",
        tasks: [
          { id: "f4-01", text: "Express API sunucusu kurulumu", tags: ["critical", "api"] },
          { id: "f4-02", text: "JWT tabanlÄ± auth (Telegram Login Widget ile doÄŸrulama)", tags: ["critical", "api"] },
          { id: "f4-03", text: "REST endpoint'leri: /teams, /players, /leagues, /matches, /transfers", tags: ["critical", "api"] },
          { id: "f4-04", text: "Rate limiting middleware (dakikada max 60 istek)", tags: ["important", "api"] },
          { id: "f4-05", text: "CORS yapÄ±landÄ±rmasÄ± (web frontend iÃ§in)", tags: ["normal", "api"] },
        ]
      },
      {
        name: "Socket.IO â€” GerÃ§ek ZamanlÄ±",
        tasks: [
          { id: "f4-06", text: "Socket.IO sunucu kurulumu (Express ile entegre)", tags: ["critical", "api"] },
          { id: "f4-07", text: "join_match event: Odaya katÄ±l, maÃ§ akÄ±ÅŸÄ±nÄ± dinle", tags: ["critical", "api"] },
          { id: "f4-08", text: "match_event emit: Her tick'te olay payload'Ä± gÃ¶nder", tags: ["critical", "engine"] },
          { id: "f4-09", text: "match_end event: MaÃ§ sonu skor ve istatistik", tags: ["important", "api"] },
          { id: "f4-10", text: "live_matches event: AnlÄ±k oynanan maÃ§lar listesi", tags: ["important", "api"] },
        ]
      },
      {
        name: "Web ArayÃ¼zÃ¼ (Next.js)",
        tasks: [
          { id: "f4-11", text: "Next.js 14 App Router + TailwindCSS kurulumu", tags: ["critical", "web"] },
          { id: "f4-12", text: "Telegram Login Widget entegrasyonu (web auth)", tags: ["critical", "web"] },
          { id: "f4-13", text: "Dashboard: TakÄ±m Ã¶zeti, bakiye, yaklaÅŸan maÃ§lar", tags: ["important", "web"] },
          { id: "f4-14", text: "TakÄ±m sayfasÄ±: Kadro listesi, formasyon gÃ¶rÃ¼nÃ¼mÃ¼", tags: ["important", "web"] },
          { id: "f4-15", text: "Lig sayfasÄ±: Puan tablosu, fikstÃ¼r, sonuÃ§lar", tags: ["important", "web"] },
          { id: "f4-16", text: "Match Tracker: GerÃ§ek zamanlÄ± maÃ§ izleme (Socket.IO)", tags: ["critical", "web"] },
          { id: "f4-17", text: "Match Tracker UI: Skor, dakika, olay listesi, ilerleme barÄ±", tags: ["important", "web"] },
          { id: "f4-18", text: "Transfer pazarÄ± sayfasÄ±: Oyuncu listele, filtrele, teklif", tags: ["important", "web"] },
          { id: "f4-19", text: "Profil sayfasÄ±: Ä°statistikler, baÅŸarÄ±lar, seviye", tags: ["normal", "web"] },
          { id: "f4-20", text: "Responsive tasarÄ±m: Mobil uyumluluk", tags: ["important", "web"] },
        ]
      },
      {
        name: "Ä°statistik SayfalarÄ±",
        tasks: [
          { id: "f4-21", text: "Gol kralÄ±, asist kralÄ± tablosu", tags: ["important", "web"] },
          { id: "f4-22", text: "En iyi GK, en iyi defans, disiplin tablosu", tags: ["normal", "web"] },
          { id: "f4-23", text: "En deÄŸerli, en geliÅŸen futbolcu tablolarÄ±", tags: ["normal", "web"] },
          { id: "f4-24", text: "TakÄ±m bazlÄ± detaylÄ± istatistikler", tags: ["normal", "web"] },
        ]
      }
    ]
  },
  {
    id: "faz5",
    phase: "Faz 5",
    title: "Turnuvalar & Sosyal",
    icon: "ğŸŸ£",
    color: "#8b5cf6",
    colorRGB: "139,92,246",
    desc: "Hafta 11-12",
    categories: [
      {
        name: "Åampiyonlar Ligi",
        tasks: [
          { id: "f5-01", text: "A Ligi ilk 4 â†’ Åampiyonlar Ligi katÄ±lÄ±m hakkÄ±", tags: ["critical", "engine"] },
          { id: "f5-02", text: "Grup aÅŸamasÄ±: 4'erli gruplar, Ã§ift devreli", tags: ["important", "engine"] },
          { id: "f5-03", text: "Eleme aÅŸamasÄ±: Ã‡eyrek final â†’ YarÄ± final â†’ Final", tags: ["important", "engine"] },
          { id: "f5-04", text: "Åampiyonlar Ligi Ã¶dÃ¼lÃ¼: 200.000 coin + Ã¶zel rozet", tags: ["normal", "engine"] },
          { id: "f5-05", text: "Pazar gÃ¼nleri 18:00 maÃ§ zamanlamasÄ±", tags: ["important", "engine"] },
        ]
      },
      {
        name: "Kupa TurnuvasÄ±",
        tasks: [
          { id: "f5-06", text: "Knockout usulÃ¼ kupa: TÃ¼m takÄ±mlar katÄ±lÄ±r", tags: ["important", "engine"] },
          { id: "f5-07", text: "Kura Ã§ekimi algoritmasÄ± (seri baÅŸÄ± + pot sistemi)", tags: ["normal", "engine"] },
          { id: "f5-08", text: "Kupa Ã¶dÃ¼lleri ve SÃ¼per Kupa", tags: ["normal", "engine"] },
        ]
      },
      {
        name: "Sosyal Ã–zellikler",
        tasks: [
          { id: "f5-09", text: "Lig TG grup otomatik oluÅŸturma", tags: ["important", "bot"] },
          { id: "f5-10", text: "/dostlukmaci @rakip komutu: Puan etkilemez, sadece XP", tags: ["important", "bot"] },
          { id: "f5-11", text: "GÃ¼nde max 3 dostluk maÃ§Ä± sÄ±nÄ±rÄ±", tags: ["normal", "engine"] },
          { id: "f5-12", text: "HaftalÄ±k MVP oylamasÄ±: En iyi performans â†’ +5 moral", tags: ["normal", "bot"] },
          { id: "f5-13", text: "All-Star maÃ§Ä±: Sezon sonu A vs B Ligi en iyi 11'ler", tags: ["normal", "engine"] },
        ]
      },
      {
        name: "Liderlik TablolarÄ±",
        tasks: [
          { id: "f5-14", text: "Gol kralÄ±, asist kralÄ± liderlik tablolarÄ± (TG bot)", tags: ["important", "bot"] },
          { id: "f5-15", text: "KullanÄ±cÄ± profil istatistikleri: MaÃ§, galibiyet %, gol", tags: ["important", "bot"] },
          { id: "f5-16", text: "BaÅŸarÄ± sistemi: 50 gol, 5 galibiyet serisi, ÅŸampiyonluk vb.", tags: ["normal", "engine"] },
          { id: "f5-17", text: "Demir Adam: En uzun sakatlÄ±ksÄ±z maÃ§ serisi", tags: ["normal", "engine"] },
        ]
      }
    ]
  },
  {
    id: "faz6",
    phase: "Faz 6",
    title: "Polish, GÃ¼venlik & Ã–lÃ§ekleme",
    icon: "âš«",
    color: "#94a3b8",
    colorRGB: "148,163,184",
    desc: "Hafta 13+",
    categories: [
      {
        name: "Anti-Cheat & GÃ¼venlik",
        tasks: [
          { id: "f6-01", text: "Ã‡oklu hesap tespiti: TG hesap yaÅŸÄ± < 7 gÃ¼n â†’ kayÄ±t engeli", tags: ["important", "api"] },
          { id: "f6-02", text: "AynÄ± IP'den max 2 hesap kontrolÃ¼ (web)", tags: ["normal", "api"] },
          { id: "f6-03", text: "Transfer suistimali: Piyasa deÄŸerinin %50 altÄ±na â†’ blok", tags: ["important", "engine"] },
          { id: "f6-04", text: "Rate limiting: Dakikada max 30 API Ã§aÄŸrÄ±sÄ± per kullanÄ±cÄ±", tags: ["important", "api"] },
          { id: "f6-05", text: "Ceza sistemi: 1. uyarÄ± â†’ 2. 3 gÃ¼n ban â†’ 3. silme", tags: ["normal", "engine"] },
        ]
      },
      {
        name: "Veri Yedekleme",
        tasks: [
          { id: "f6-06", text: "PostgreSQL WAL: Son 7 gÃ¼n point-in-time recovery", tags: ["important", "db"] },
          { id: "f6-07", text: "GÃ¼nlÃ¼k pg_dump â†’ S3/MinIO yedekleme (cron 04:00)", tags: ["important", "db"] },
          { id: "f6-08", text: "Redis RDB snapshot: Her 15 dakikada bir", tags: ["normal", "db"] },
          { id: "f6-09", text: "Kurtarma prosedÃ¼rÃ¼ dokÃ¼mantasyonu ve test", tags: ["normal"] },
        ]
      },
      {
        name: "Performans & Ã–lÃ§ekleme",
        tasks: [
          { id: "f6-10", text: "Redis cache: Puan tablosu, sÄ±k eriÅŸilen veriler", tags: ["important", "db"] },
          { id: "f6-11", text: "BullMQ worker sayÄ±sÄ±nÄ± artÄ±rma (3+ paralel)", tags: ["normal", "engine"] },
          { id: "f6-12", text: "VeritabanÄ± index optimizasyonu (sÄ±k sorgular)", tags: ["important", "db"] },
          { id: "f6-13", text: "Socket.IO room yÃ¶netimi optimizasyonu", tags: ["normal", "api"] },
          { id: "f6-14", text: "VPS deployment: 2 vCPU, 4GB RAM sunucu kurulumu", tags: ["important"] },
          { id: "f6-15", text: "PM2 veya Docker production deployment", tags: ["important"] },
          { id: "f6-16", text: "Nginx reverse proxy + SSL sertifikasÄ±", tags: ["important"] },
        ]
      },
      {
        name: "Son DokunuÅŸlar",
        tasks: [
          { id: "f6-17", text: "Ekonomi denge testi: 25-30 oyuncuyla 2 sezon simÃ¼lasyon", tags: ["critical", "engine"] },
          { id: "f6-18", text: "Hata yakalama ve loglama iyileÅŸtirmesi", tags: ["important"] },
          { id: "f6-19", text: "KullanÄ±cÄ± geri bildirim toplama mekanizmasÄ±", tags: ["normal", "bot"] },
          { id: "f6-20", text: "README.md ve kurulum dokÃ¼mantasyonu", tags: ["normal"] },
          { id: "f6-21", text: "Oyuncu onboarding akÄ±ÅŸÄ± son test ve iyileÅŸtirme", tags: ["important", "bot"] },
        ]
      }
    ]
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = "fm_project_tracker_v2";

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) return JSON.parse(raw);
  } catch(e) {}
  return { done: {}, notes: "", collapsed: {} };
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

let state = loadState();
let activeFilter = "all";
let searchQuery = "";
let activePhase = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMPUTED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getAllTasks() {
  const tasks = [];
  PROJECT.forEach(phase => {
    phase.categories.forEach(cat => {
      cat.tasks.forEach(t => tasks.push({ ...t, phaseId: phase.id, phaseName: phase.phase }));
    });
  });
  return tasks;
}

function getPhaseStats(phase) {
  let total = 0, done = 0;
  phase.categories.forEach(cat => {
    cat.tasks.forEach(t => {
      total++;
      if (state.done[t.id]) done++;
    });
  });
  return { total, done, pct: total > 0 ? Math.round((done / total) * 100) : 0 };
}

function getTotalStats() {
  const all = getAllTasks();
  const done = all.filter(t => state.done[t.id]).length;
  return { total: all.length, done, pct: all.length > 0 ? Math.round((done / all.length) * 100) : 0 };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROMPT FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openPrompt(promptId) {
  const el = document.getElementById(promptId);
  if (!el) return;
  const title = el.getAttribute("data-title") || "Prompt";
  document.getElementById("prompt-modal-title").textContent = title;
  document.getElementById("prompt-modal-content").textContent = el.value;
  document.getElementById("prompt-modal").classList.add("show");
  document.body.style.overflow = "hidden";
  // Reset copy button
  const btn = document.getElementById("prompt-copy-btn");
  btn.textContent = "ğŸ“‹ Kopyala";
  btn.classList.remove("copied");
}

function closePrompt() {
  document.getElementById("prompt-modal").classList.remove("show");
  document.body.style.overflow = "";
}

function copyPrompt() {
  const content = document.getElementById("prompt-modal-content").textContent;
  navigator.clipboard.writeText(content).then(() => {
    const btn = document.getElementById("prompt-copy-btn");
    btn.textContent = "âœ… KopyalandÄ±!";
    btn.classList.add("copied");
    setTimeout(() => {
      btn.textContent = "ğŸ“‹ Kopyala";
      btn.classList.remove("copied");
    }, 2500);
  });
}

// ESC key to close modal
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closePrompt();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  renderHeaderStats();
  renderOverview();
  renderPhases();
}

function renderHeaderStats() {
  const s = getTotalStats();
  document.getElementById("stat-done").textContent = s.done;
  document.getElementById("stat-total").textContent = s.total;
  document.getElementById("stat-pct").textContent = s.pct + "%";
}

function renderOverview() {
  const el = document.getElementById("overview");
  el.innerHTML = PROJECT.map(phase => {
    const s = getPhaseStats(phase);
    const isActive = activePhase === phase.id;
    return `
      <div class="overview-card ${isActive ? 'active' : ''}"
           style="--card-accent:${phase.color}; --card-accent-rgb:${phase.colorRGB}"
           onclick="togglePhaseFilter('${phase.id}')">
        <div class="oc-header">
          <div class="oc-phase">${phase.phase}</div>
          <div class="oc-icon">${phase.icon}</div>
        </div>
        <div class="oc-title">${phase.title}</div>
        <div class="oc-progress-bar">
          <div class="oc-progress-fill" style="width:${s.pct}%; background:${phase.color}"></div>
        </div>
        <div class="oc-stats">
          <span><strong>${s.done}</strong> / ${s.total}</span>
          <span style="color:${phase.color}; font-weight:600">${s.pct}%</span>
        </div>
      </div>
    `;
  }).join("");
}

function renderPhases() {
  const container = document.getElementById("phases-container");
  const phases = activePhase ? PROJECT.filter(p => p.id === activePhase) : PROJECT;

  container.innerHTML = phases.map(phase => {
    const s = getPhaseStats(phase);
    const catsHTML = phase.categories.map(cat => {
      const catKey = phase.id + "-" + cat.name;
      const isCollapsed = state.collapsed[catKey];
      let catDone = 0;
      cat.tasks.forEach(t => { if (state.done[t.id]) catDone++; });

      const filteredTasks = cat.tasks.filter(t => {
        if (activeFilter === "done" && !state.done[t.id]) return false;
        if (activeFilter === "todo" && state.done[t.id]) return false;
        if (searchQuery) {
          const q = searchQuery.toLowerCase();
          return t.text.toLowerCase().includes(q) || t.tags.some(tag => tag.includes(q));
        }
        return true;
      });

      if (filteredTasks.length === 0 && (activeFilter !== "all" || searchQuery)) return "";

      // Check for prompt
      const promptId = PROMPT_MAP[catKey];
      const promptBtn = promptId
        ? `<button class="prompt-btn" onclick="event.stopPropagation(); openPrompt('${promptId}')" title="Bu kategori iÃ§in hazÄ±r prompt'u gÃ¶ster">ğŸ“‹ Prompt</button>`
        : "";

      const tasksHTML = filteredTasks.map(t => {
        const isDone = !!state.done[t.id];
        const tagsHTML = t.tags.map(tag => `<span class="task-tag tag-${tag}">${tag}</span>`).join("");
        return `
          <div class="task ${isDone ? 'done' : ''}" onclick="toggleTask('${t.id}')">
            <div class="checkbox">
              <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <div class="task-content">
              <div class="task-text">${t.text}</div>
              <div class="task-meta">${tagsHTML}</div>
            </div>
          </div>
        `;
      }).join("");

      return `
        <div class="category">
          <div class="category-header" onclick="toggleCategory('${catKey}')">
            <div class="category-chevron ${isCollapsed ? '' : 'open'}">â–¶</div>
            <div class="category-title">${cat.name}</div>
            <div class="category-right">
              ${promptBtn}
              <div class="category-count">${catDone}/${cat.tasks.length}</div>
            </div>
          </div>
          <div class="category-tasks ${isCollapsed ? 'collapsed' : ''}" style="max-height: ${isCollapsed ? '0' : filteredTasks.length * 100 + 'px'}">
            ${tasksHTML}
          </div>
        </div>
      `;
    }).join("");

    return `
      <div class="phase-section">
        <div class="phase-header">
          <span class="phase-badge" style="background:${phase.color}22; color:${phase.color}; border:1px solid ${phase.color}44">${phase.phase}</span>
          <span class="phase-title">${phase.title}</span>
          <span class="phase-desc">${phase.desc} â€” ${s.pct}% tamamlandÄ±</span>
        </div>
        ${catsHTML}
      </div>
    `;
  }).join("");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTask(id) {
  state.done[id] = !state.done[id];
  if (!state.done[id]) delete state.done[id];
  saveState();
  render();
}

function toggleCategory(key) {
  state.collapsed[key] = !state.collapsed[key];
  if (!state.collapsed[key]) delete state.collapsed[key];
  saveState();
  render();
}

function togglePhaseFilter(phaseId) {
  activePhase = activePhase === phaseId ? null : phaseId;
  render();
}

function setFilter(f, el) {
  activeFilter = f;
  document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
  el.classList.add("active");
  render();
}

function exportJSON() {
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "fm-tracker-backup.json"; a.click();
  URL.revokeObjectURL(url);
}

function importJSON() {
  const input = document.createElement("input");
  input.type = "file"; input.accept = ".json";
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const imported = JSON.parse(ev.target.result);
        if (imported.done) {
          state = imported;
          saveState();
          render();
          document.getElementById("notes-area").value = state.notes || "";
          alert("âœ… Ä°Ã§e aktarma baÅŸarÄ±lÄ±!");
        }
      } catch(err) { alert("âŒ GeÃ§ersiz dosya formatÄ±"); }
    };
    reader.readAsText(file);
  };
  input.click();
}

function resetAll() {
  if (confirm("âš ï¸ TÃ¼m ilerleme sÄ±fÄ±rlansÄ±n mÄ±? Bu iÅŸlem geri alÄ±namaz!")) {
    state = { done: {}, notes: "", collapsed: {} };
    saveState();
    document.getElementById("notes-area").value = "";
    render();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
render();
document.getElementById("notes-area").value = state.notes || "";
</script>
</body>
</html>